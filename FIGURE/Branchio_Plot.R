# BRANCHIO PLOTTING
# Needed packages
suppressWarnings({
  library(MCMCtreeR, quietly = TRUE, warn.conflicts = FALSE)
  library(readr)
  library(ape)
  library(scales)
  library(ggplot2)
  library(tm)
  library(gridExtra)
  library(fmsb)
  library(devtools)
  library(cowplot)
  library(dplyr)
  library(magick)
  library(grImport2)
  library(ggridges)
  library(viridis)
  library(forcats)
})

cat("All required packages have been successfully loaded.\n")


#FIGURA 1
branchiopoda_occ <- read.table("./branchiopoda_occ.txt", sep=",", header = T)
branchiopoda_occ <- cbind(rep("Branchiopoda",length(branchiopoda_occ[1])),branchiopoda_occ)
colnames(branchiopoda_occ)[1] <- "Group"

mean_value_crown <- 406.5917
min_value_crown <- 405.06000
max_value_crown <- 409.4840
mean_value_stem <- 495.8419
min_value_stem <- 473.972
max_value_stem <- 528.311
plot_branchio <- ggplot(branchiopoda_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect", xmin = 405.06, xmax = 409.4840, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 473.972, xmax = 528.311, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#B87333",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

cladocera_occ <- read.table("./cladocera_occ.txt", sep=",", header = T)
cladocera_occ <- cbind(rep("Cladocera",length(cladocera_occ[1])),cladocera_occ)
colnames(cladocera_occ)[1] <- "Group"

mean_value_crown <- 174.5135
min_value_crown <-  173.15200
max_value_crown <- 177.0820
mean_value_stem <- 195.7127
min_value_stem <- 183.13900
max_value_stem <- 222.7480
plot_clado <- ggplot(cladocera_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect",xmin = 173.15200, xmax = 177.0820, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect",xmin = 183.13900, xmax = 222.7480, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#FF6347",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

notostraca_occ <- read.table("./notostraca_occ.txt", sep=",", header = T)
notostraca_occ <- cbind(rep("Notostraca",length(notostraca_occ[1])),notostraca_occ)
colnames(notostraca_occ)[1] <- "Group"

mean_value_crown <- 123.5135
min_value_crown <-  121.87200
max_value_crown <- 126.5260
mean_value_stem <- 322.2284
min_value_stem <- 252.25600
max_value_stem <- 376.6370
plot_noto <- ggplot(notostraca_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect",xmin = 121.87200, xmax = 126.5260, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 252.25600, xmax = 376.6370, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#DAA520",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

anostraca_occ <- read.table("./anostraca_occ.txt", sep=",", header = T)
anostraca_occ <- cbind(rep("Anostraca",length(anostraca_occ[1])),anostraca_occ)
colnames(anostraca_occ)[1] <- "Group"

mean_value_crown <- 127.3788
min_value_crown <-  125.78200
max_value_crown <- 130.3390
mean_value_stem <- 406.5917
min_value_stem <- 405.06000
max_value_stem <- 409.4840
plot_anos <- ggplot(anostraca_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect", xmin = 125.78200, xmax = 130.3390, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 405.06000, xmax = 409.4840, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#008080",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

anostraca_2_occ <- read.table("./anostraca_occ.txt", sep=",", header = T)
anostraca_2_occ <- cbind(rep("Branchiopoda",length(anostraca_2_occ[1])),anostraca_2_occ)
colnames(anostraca_2_occ)[1] <- "Group"
branchio_anos_occ <- rbind(branchiopoda_occ,anostraca_2_occ)


plot_branchio_anos <- ggplot(branchio_anos_occ, aes(x = max_ma)) +
  ggplot2::annotate(geom = "rect", xmin = 125.78200, xmax = 130.3390, ymin = 0, ymax = Inf,
                    fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 405.06000, xmax = 409.4840, ymin = 0, ymax = Inf,
                    fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#B87333",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")


pdf("./fossils_occurences.pdf", width = 11.7, height = 8.3)
plot_grid(plot_branchio_anos,plot_anos,plot_noto,plot_clado,ncol=1)
dev.off()


complete_dataset <- rbind(branchio_anos_occ,anostraca_occ,notostraca_occ,cladocera_occ)

complete_dataset$Ma_Bin <- cut(complete_dataset$max_ma, breaks = seq(0, max(complete_dataset$max_ma) + 50, by = 50), labels = FALSE)

count_df <- complete_dataset %>%
  group_by(Group, Ma_Bin) %>%
  summarize(Count = n())

count_df$Ma_Bin <- paste0((as.numeric(count_df$Ma_Bin) - 1) * 50, "-", as.numeric(count_df$Ma_Bin) * 50, "Ma")

count_df <- count_df[order(count_df$Group, count_df$Ma_Bin),]

count_df <- as.data.frame(count_df)


order_vector <- c("0-50Ma", "50-100Ma", "100-150Ma", "150-200Ma", "200-250Ma", "250-300Ma", 
                  "300-350Ma", "350-400Ma", "400-450Ma", "450-500Ma", "500-550Ma")
order_vector <- rev(order_vector)

count_df$Ma_Bin <- factor(count_df$Ma_Bin, levels = order_vector)

desired_order <- c("Cladocera", "Notostraca", "Anostraca", "Branchiopoda")

plot_fossils_circle <- ggplot(count_df, aes(x = Ma_Bin, y = fct_inorder(Group), color = Count, size = Count)) +
  geom_point() +
  scale_colour_viridis_c(name = "Count") +
  scale_size_continuous(range = c(1, 25), name = "Count") +
  theme(legend.position = "bottom") +
  guides(color = guide_legend(), size = guide_legend()) +
  theme_bw() +
  labs(x = "", y = "")

# Order the levels of the 'Group' variable according to 'desired_order'
plot_fossils_circle <- plot_fossils_circle + 
  scale_y_discrete(limits = desired_order)


pdf("./fossils_occurences_circles.pdf", width = 11.7, height = 5.3)
plot_fossils_circle
dev.off()




# JACKKNIFE PLOT
# All fossils
all.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.848493, Iele: 4.848493) [&95%={3.81246, 5.69126}]: 0.324486, (((Blyn: 0.183483, Blin: 0.183483) [&95%={0.0847524, 0.349781}]: 1.091604, (Afr1: 1.053374, (Bher: 0.741404, (Stsp: 0.599355, Tpla: 0.599355) [&95%={0.385747, 0.817728}]: 0.142049) [&95%={0.52585, 0.944749}]: 0.311971) [&95%={0.870009, 1.18177}]: 0.221713) [&95%={1.25791, 1.30601}]: 2.790971, (((Tlon: 0.459209, (Tita: 0.042333, (Tusa: 0.004908, Tjap: 0.004908) [&95%={0.0022087, 0.0097336}]: 0.037426) [&95%={0.0206915, 0.0803842}]: 0.416876) [&95%={0.222185, 0.809971}]: 0.772728, ((Lcry: 0.075381, Lpac: 0.075381) [&95%={0.0350263, 0.140941}]: 0.164834, (Lubb: 0.087096, (Lapu: 0.072839, (Lcou: 0.036019, Lart: 0.036019) [&95%={0.0183237, 0.0626149}]: 0.036820) [&95%={0.0440445, 0.113719}]: 0.014257) [&95%={0.055115, 0.131698}]: 0.153118) [&95%={0.145528, 0.39566}]: 0.991722) [&95%={1.21848, 1.25871}]: 2.216226, (Lysp: 2.978259, (((Orub: 0.372016, (Ozsp: 0.300488, Cpil: 0.300488) [&95%={0.152237, 0.534596}]: 0.071528) [&95%={0.211772, 0.619124}]: 1.024664, ((Eosp: 0.951087, (Ldah: 0.493508, Etic: 0.493508) [&95%={0.265791, 0.788934}]: 0.457579) [&95%={0.672564, 1.26007}]: 0.203246, ((Mesp: 0.397918, Etex: 0.397918) [&95%={0.20474, 0.663208}]: 0.425019, (Puru: 0.376573, (Lpar: 0.197297, Lbir: 0.197297) [&95%={0.0980009, 0.346929}]: 0.179276) [&95%={0.226598, 0.587721}]: 0.446364) [&95%={0.574762, 1.13005}]: 0.331396) [&95%={0.886453, 1.49986}]: 0.242347) [&95%={1.08254, 1.80194}]: 1.154947, ((Chis: 0.525988, C146: 0.525988) [&95%={0.237675, 0.991174}]: 1.529127, (Scry: 1.746552, ((Pped: 1.159143, (Pleu: 0.661385, Enor: 0.661385) [&95%={0.372042, 0.985747}]: 0.497758) [&95%={0.85386, 1.41609}]: 0.433512, ((Bosp: 1.006935, (Elam: 0.145816, Aema: 0.145816) [&95%={0.0676681, 0.274699}]: 0.861119) [&95%={0.673296, 1.26163}]: 0.412320, (Mosp: 1.094142, (Masp: 0.966069, ((Cqua: 0.614324, (Svet: 0.224113, Smuc: 0.224113) [&95%={0.117718, 0.372385}]: 0.390211) [&95%={0.438641, 0.808974}]: 0.153198, (Dmag: 0.492747, (Dgal: 0.272179, (Dpul: 0.039349, Dpli: 0.039349) [&95%={0.0183865, 0.0755922}]: 0.232831) [&95%={0.152902, 0.435399}]: 0.220567) [&95%={0.332394, 0.690697}]: 0.274775) [&95%={0.592739, 0.958237}]: 0.198547) [&95%={0.773892, 1.15275}]: 0.128074) [&95%={0.894723, 1.26377}]: 0.325113) [&95%={1.23094, 1.55686}]: 0.173400) [&95%={1.44829, 1.68431}]: 0.153897) [&95%={1.73162, 1.77298}]: 0.308563) [&95%={1.85787, 2.38454}]: 0.496512) [&95%={2.18149, 3.0067}]: 0.426632) [&95%={2.51761, 3.4421}]: 0.469904) [&95%={2.95025, 3.83046}]: 0.617896) [&95%={4.05064, 4.09476}]: 1.106920) [&95%={4.88981, 5.85287}];","END;"))
all.tree <- readMCMCtree(all.tree, from.file = FALSE)
# No 1
no1.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.545354, Iele: 4.545354) [&95%={3.6096, 5.13489}]: 0.372651, (((Blyn: 0.194618, Blin: 0.194618) [&95%={0.0898514, 0.372521}]: 1.492757, (Afr1: 1.351545, (Bher: 0.914552, (Stsp: 0.750826, Tpla: 0.750826) [&95%={0.439405, 1.11716}]: 0.163726) [&95%={0.58642, 1.28542}]: 0.436994) [&95%={0.943223, 1.90493}]: 0.335829) [&95%={1.18207, 2.39346}]: 2.378752, (((Tlon: 0.465025, (Tita: 0.043575, (Tusa: 0.004998, Tjap: 0.004998) [&95%={0.0023062, 0.0096358}]: 0.038578) [&95%={0.0212877, 0.0820564}]: 0.421449) [&95%={0.2333, 0.794419}]: 0.767781, ((Lcry: 0.076492, Lpac: 0.076492) [&95%={0.0363927, 0.141044}]: 0.167774, (Lubb: 0.088828, (Lapu: 0.074369, (Lcou: 0.036806, Lart: 0.036806) [&95%={0.0190316, 0.0646901}]: 0.037562) [&95%={0.0456319, 0.117127}]: 0.014459) [&95%={0.0567158, 0.136143}]: 0.155438) [&95%={0.150102, 0.39687}]: 0.988540) [&95%={1.21854, 1.26035}]: 2.225822, (Lysp: 2.991085, (((Orub: 0.378959, (Ozsp: 0.306729, Cpil: 0.306729) [&95%={0.160464, 0.538998}]: 0.072230) [&95%={0.218714, 0.624789}]: 1.066460, ((Eosp: 0.982998, (Ldah: 0.509993, Etic: 0.509993) [&95%={0.274723, 0.815146}]: 0.473005) [&95%={0.697957, 1.30364}]: 0.206230, ((Mesp: 0.409412, Etex: 0.409412) [&95%={0.213942, 0.676962}]: 0.433383, (Puru: 0.384329, (Lpar: 0.199439, Lbir: 0.199439) [&95%={0.0996961, 0.348838}]: 0.184891) [&95%={0.228753, 0.597811}]: 0.458465) [&95%={0.585533, 1.14716}]: 0.346434) [&95%={0.902681, 1.52722}]: 0.256192) [&95%={1.09567, 1.81392}]: 1.117352, ((Chis: 0.535220, C146: 0.535220) [&95%={0.260464, 0.96797}]: 1.526318, (Scry: 1.746902, ((Pped: 1.164216, (Pleu: 0.659873, Enor: 0.659873) [&95%={0.378384, 0.982494}]: 0.504343) [&95%={0.865267, 1.43007}]: 0.435568, ((Bosp: 1.007926, (Elam: 0.148782, Aema: 0.148782) [&95%={0.0708153, 0.276806}]: 0.859145) [&95%={0.692827, 1.25522}]: 0.424801, (Mosp: 1.101071, (Masp: 0.972717, ((Cqua: 0.620126, (Svet: 0.228672, Smuc: 0.228672) [&95%={0.122662, 0.374781}]: 0.391454) [&95%={0.450142, 0.801824}]: 0.153814, (Dmag: 0.500213, (Dgal: 0.276836, (Dpul: 0.040149, Dpli: 0.040149) [&95%={0.0188913, 0.0765584}]: 0.236687) [&95%={0.156966, 0.437803}]: 0.223377) [&95%={0.341519, 0.68208}]: 0.273727) [&95%={0.611441, 0.948546}]: 0.198778) [&95%={0.797454, 1.13953}]: 0.128354) [&95%={0.921993, 1.26045}]: 0.331657) [&95%={1.27098, 1.55679}]: 0.167055) [&95%={1.4781, 1.68311}]: 0.147119) [&95%={1.73176, 1.77368}]: 0.314635) [&95%={1.86314, 2.38433}]: 0.501234) [&95%={2.19371, 3.00019}]: 0.428314) [&95%={2.53724, 3.44358}]: 0.467542) [&95%={2.97065, 3.82814}]: 0.607499) [&95%={4.05066, 4.09462}]: 0.851879) [&95%={4.73433, 5.26277}];","END;"))
no1.tree <- readMCMCtree(no1.tree, from.file = FALSE)
# No 2
no2.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.570994, Iele: 4.570994) [&95%={3.67522, 5.1203}]: 0.340136, (((Blyn: 0.177251, Blin: 0.177251) [&95%={0.0848246, 0.332784}]: 1.095989, (Afr1: 1.052981, (Bher: 0.739806, (Stsp: 0.600491, Tpla: 0.600491) [&95%={0.385832, 0.813561}]: 0.139315) [&95%={0.525074, 0.939341}]: 0.313175) [&95%={0.878538, 1.17836}]: 0.220259) [&95%={1.2577, 1.30224}]: 2.792782, (((Tlon: 0.394747, (Tita: 0.040514, (Tusa: 0.004683, Tjap: 0.004683) [&95%={0.002151, 0.0090333}]: 0.035831) [&95%={0.0201569, 0.0751814}]: 0.354233) [&95%={0.203047, 0.694853}]: 0.548135, ((Lcry: 0.071436, Lpac: 0.071436) [&95%={0.0336235, 0.133729}]: 0.153561, (Lubb: 0.083386, (Lapu: 0.069844, (Lcou: 0.034644, Lart: 0.034644) [&95%={0.0180212, 0.0593996}]: 0.035200) [&95%={0.0428383, 0.109183}]: 0.013541) [&95%={0.0536606, 0.126249}]: 0.141611) [&95%={0.138241, 0.360742}]: 0.717885) [&95%={0.585592, 1.41713}]: 2.481910, (Lysp: 2.953956, (((Orub: 0.357272, (Ozsp: 0.289444, Cpil: 0.289444) [&95%={0.150453, 0.499148}]: 0.067828) [&95%={0.205892, 0.578724}]: 1.004060, ((Eosp: 0.929668, (Ldah: 0.482261, Etic: 0.482261) [&95%={0.258261, 0.762821}]: 0.447407) [&95%={0.661146, 1.22285}]: 0.194912, ((Mesp: 0.388525, Etex: 0.388525) [&95%={0.204861, 0.638226}]: 0.411467, (Puru: 0.360926, (Lpar: 0.188335, Lbir: 0.188335) [&95%={0.0964201, 0.325335}]: 0.172590) [&95%={0.215721, 0.557346}]: 0.439066) [&95%={0.5704, 1.07517}]: 0.324589) [&95%={0.870957, 1.44129}]: 0.236751) [&95%={1.06323, 1.7281}]: 1.167594, ((Chis: 0.514019, C146: 0.514019) [&95%={0.241797, 0.946216}]: 1.531450, (Scry: 1.746386, ((Pped: 1.151533, (Pleu: 0.651518, Enor: 0.651518) [&95%={0.370884, 0.970535}]: 0.500015) [&95%={0.8519, 1.40887}]: 0.438107, ((Bosp: 0.997194, (Elam: 0.140946, Aema: 0.140946) [&95%={0.0667217, 0.262862}]: 0.856248) [&95%={0.675189, 1.25187}]: 0.417876, (Mosp: 1.080287, (Masp: 0.952826, ((Cqua: 0.604058, (Svet: 0.218673, Smuc: 0.218673) [&95%={0.117488, 0.357406}]: 0.385385) [&95%={0.435467, 0.787257}]: 0.149638, (Dmag: 0.483128, (Dgal: 0.266442, (Dpul: 0.037902, Dpli: 0.037902) [&95%={0.0177248, 0.0724453}]: 0.228540) [&95%={0.148407, 0.426607}]: 0.216686) [&95%={0.325529, 0.666051}]: 0.270567) [&95%={0.588822, 0.929023}]: 0.199130) [&95%={0.766798, 1.12867}]: 0.127461) [&95%={0.889258, 1.2507}]: 0.334784) [&95%={1.22338, 1.55365}]: 0.174569) [&95%={1.44917, 1.68181}]: 0.156747) [&95%={1.73165, 1.77237}]: 0.299083) [&95%={1.85589, 2.36271}]: 0.483456) [&95%={2.16252, 2.99115}]: 0.425030) [&95%={2.49403, 3.43034}]: 0.470836) [&95%={2.91414, 3.82383}]: 0.641230) [&95%={4.05062, 4.09543}]: 0.845108) [&95%={4.73308, 5.25563}];","END;"))
no2.tree <- readMCMCtree(no2.tree, from.file = FALSE)
# No 3
no3.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.502765, Iele: 4.502765) [&95%={3.52328, 5.11892}]: 0.412609, (((Blyn: 0.194956, Blin: 0.194956) [&95%={0.0937995, 0.363964}]: 1.080599, (Afr1: 1.057199, (Bher: 0.748820, (Stsp: 0.604689, Tpla: 0.604689) [&95%={0.39962, 0.808969}]: 0.144130) [&95%={0.546897, 0.940106}]: 0.308380) [&95%={0.889992, 1.17812}]: 0.218356) [&95%={1.25786, 1.306}]: 2.790866, (((Tlon: 0.479348, (Tita: 0.044668, (Tusa: 0.005140, Tjap: 0.005140) [&95%={0.0023986, 0.0097184}]: 0.039528) [&95%={0.022568, 0.0822742}]: 0.434680) [&95%={0.244492, 0.8045}]: 0.753446, ((Lcry: 0.078489, Lpac: 0.078489) [&95%={0.0379632, 0.14356}]: 0.171345, (Lubb: 0.091565, (Lapu: 0.076781, (Lcou: 0.037782, Lart: 0.037782) [&95%={0.0197754, 0.0647102}]: 0.038998) [&95%={0.0476106, 0.119883}]: 0.014784) [&95%={0.0592488, 0.13845}]: 0.158270) [&95%={0.154508, 0.404308}]: 0.982959) [&95%={1.21854, 1.26032}]: 2.372027, (Lysp: 3.230432, (((Orub: 0.394220, (Ozsp: 0.320454, Cpil: 0.320454) [&95%={0.169328, 0.54625}]: 0.073766) [&95%={0.230459, 0.633016}]: 1.067787, ((Eosp: 0.984028, (Ldah: 0.516424, Etic: 0.516424) [&95%={0.286715, 0.818247}]: 0.467604) [&95%={0.708938, 1.27787}]: 0.208338, ((Mesp: 0.415893, Etex: 0.415893) [&95%={0.222677, 0.682898}]: 0.436287, (Puru: 0.392537, (Lpar: 0.205892, Lbir: 0.205892) [&95%={0.106499, 0.354488}]: 0.186645) [&95%={0.239848, 0.60448}]: 0.459643) [&95%={0.607449, 1.18088}]: 0.340186) [&95%={0.922585, 1.59744}]: 0.269640) [&95%={1.13249, 2.00192}]: 1.419120, ((Chis: 0.569570, C146: 0.569570) [&95%={0.272991, 1.04119}]: 1.917395, (Scry: 2.228284, ((Pped: 1.358136, (Pleu: 0.753348, Enor: 0.753348) [&95%={0.409538, 1.21052}]: 0.604788) [&95%={0.955545, 1.89846}]: 0.638657, ((Bosp: 1.168675, (Elam: 0.156096, Aema: 0.156096) [&95%={0.0749631, 0.289244}]: 1.012579) [&95%={0.798729, 1.60191}]: 0.581245, (Mosp: 1.242071, (Masp: 1.092742, ((Cqua: 0.691931, (Svet: 0.246521, Smuc: 0.246521) [&95%={0.133663, 0.406401}]: 0.445409) [&95%={0.495793, 0.906451}]: 0.169852, (Dmag: 0.546401, (Dgal: 0.298489, (Dpul: 0.041562, Dpli: 0.041562) [&95%={0.0198297, 0.077226}]: 0.256927) [&95%={0.168625, 0.475645}]: 0.247912) [&95%={0.366493, 0.758908}]: 0.315382) [&95%={0.666993, 1.07482}]: 0.230960) [&95%={0.883318, 1.31663}]: 0.149328) [&95%={1.02547, 1.52733}]: 0.507849) [&95%={1.44719, 2.11651}]: 0.246874) [&95%={1.66476, 2.39251}]: 0.231491) [&95%={1.87062, 2.62823}]: 0.258681) [&95%={2.09906, 2.89651}]: 0.394162) [&95%={2.46756, 3.27015}]: 0.349305) [&95%={2.81352, 3.58796}]: 0.374389) [&95%={3.2183, 3.8741}]: 0.461601) [&95%={4.05069, 4.09543}]: 0.848953) [&95%={4.735, 5.26079}];","END;"))
no3.tree <- readMCMCtree(no3.tree, from.file = FALSE)
# No 4
no4.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.465580, Iele: 4.465580) [&95%={3.33452, 5.10306}]: 0.459878, (((Blyn: 0.184207, Blin: 0.184207) [&95%={0.0834089, 0.354123}]: 1.090862, (Afr1: 1.053789, (Bher: 0.741610, (Stsp: 0.599761, Tpla: 0.599761) [&95%={0.384523, 0.81356}]: 0.141849) [&95%={0.524897, 0.944602}]: 0.312180) [&95%={0.875451, 1.18038}]: 0.221280) [&95%={1.25786, 1.30517}]: 2.932861, (((Tlon: 0.462219, (Tita: 0.042325, (Tusa: 0.004871, Tjap: 0.004871) [&95%={0.0021864, 0.0095988}]: 0.037454) [&95%={0.0206514, 0.0810233}]: 0.419894) [&95%={0.224696, 0.805649}]: 0.769710, ((Lcry: 0.074425, Lpac: 0.074425) [&95%={0.0347255, 0.141863}]: 0.164152, (Lubb: 0.086151, (Lapu: 0.072021, (Lcou: 0.035475, Lart: 0.035475) [&95%={0.0179774, 0.0615391}]: 0.036545) [&95%={0.0436187, 0.113657}]: 0.014130) [&95%={0.0544796, 0.131751}]: 0.152426) [&95%={0.143526, 0.39528}]: 0.993353) [&95%={1.21848, 1.25876}]: 2.279907, (Lysp: 3.018192, (((Orub: 0.369387, (Ozsp: 0.298530, Cpil: 0.298530) [&95%={0.154004, 0.522157}]: 0.070857) [&95%={0.211986, 0.605985}]: 1.014219, ((Eosp: 0.943501, (Ldah: 0.490177, Etic: 0.490177) [&95%={0.261952, 0.796742}]: 0.453324) [&95%={0.666396, 1.26086}]: 0.200614, ((Mesp: 0.395534, Etex: 0.395534) [&95%={0.202067, 0.652988}]: 0.420203, (Puru: 0.372580, (Lpar: 0.194490, Lbir: 0.194490) [&95%={0.0987225, 0.340565}]: 0.178091) [&95%={0.223256, 0.577885}]: 0.443157) [&95%={0.576029, 1.12255}]: 0.328378) [&95%={0.87789, 1.49551}]: 0.239491) [&95%={1.07667, 1.78052}]: 1.185887, ((Chis: 0.524097, C146: 0.524097) [&95%={0.244099, 0.976962}]: 1.532962, (Scry: 1.746567, ((Pped: 1.159734, (Pleu: 0.659195, Enor: 0.659195) [&95%={0.367754, 0.982363}]: 0.500540) [&95%={0.850441, 1.41716}]: 0.431210, ((Bosp: 1.003591, (Elam: 0.144822, Aema: 0.144822) [&95%={0.0667274, 0.273061}]: 0.858770) [&95%={0.671659, 1.2629}]: 0.412226, (Mosp: 1.083666, (Masp: 0.955128, ((Cqua: 0.605810, (Svet: 0.223790, Smuc: 0.223790) [&95%={0.118674, 0.370758}]: 0.382020) [&95%={0.429123, 0.798361}]: 0.151810, (Dmag: 0.485930, (Dgal: 0.268588, (Dpul: 0.038992, Dpli: 0.038992) [&95%={0.0181031, 0.0748627}]: 0.229596) [&95%={0.148645, 0.429312}]: 0.217341) [&95%={0.326037, 0.678764}]: 0.271690) [&95%={0.582713, 0.947522}]: 0.197509) [&95%={0.758533, 1.14669}]: 0.128538) [&95%={0.877547, 1.26341}]: 0.332151) [&95%={1.22052, 1.55877}]: 0.175127) [&95%={1.44307, 1.68303}]: 0.155623) [&95%={1.73167, 1.77312}]: 0.310492) [&95%={1.85444, 2.42067}]: 0.512435) [&95%={2.16114, 3.1775}]: 0.448698) [&95%={2.47819, 3.72727}]: 0.493644) [&95%={2.85575, 4.26597}]: 0.696094) [&95%={3.40507, 4.93533}]: 0.717529) [&95%={4.7356, 5.26189}];","END;"))
no4.tree <- readMCMCtree(no4.tree, from.file = FALSE)
# No Lysp
nolysp.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.567391, Iele: 4.567391) [&95%={3.64554, 5.13013}]: 0.348361, (((Blyn: 0.184843, Blin: 0.184843) [&95%={0.0858299, 0.35493}]: 1.090215, (Afr1: 1.051796, (Bher: 0.741638, (Stsp: 0.598639, Tpla: 0.598639) [&95%={0.383803, 0.812534}]: 0.142999) [&95%={0.525328, 0.944971}]: 0.310158) [&95%={0.872574, 1.18086}]: 0.223263) [&95%={1.25792, 1.3051}]: 2.791021, (((Tlon: 0.462610, (Tita: 0.041969, (Tusa: 0.004952, Tjap: 0.004952) [&95%={0.0022598, 0.0097788}]: 0.037018) [&95%={0.0205872, 0.0784247}]: 0.420641) [&95%={0.220289, 0.809126}]: 0.769301, ((Lcry: 0.072841, Lpac: 0.072841) [&95%={0.0337677, 0.13588}]: 0.162456, (Lubb: 0.085198, (Lapu: 0.071107, (Lcou: 0.035190, Lart: 0.035190) [&95%={0.0180125, 0.0614742}]: 0.035917) [&95%={0.0431286, 0.112514}]: 0.014091) [&95%={0.0539564, 0.13048}]: 0.150099) [&95%={0.140888, 0.38818}]: 0.996614) [&95%={1.21846, 1.25891}]: 2.160812, (((Orub: 0.372032, (Ozsp: 0.300639, Cpil: 0.300639) [&95%={0.154036, 0.529116}]: 0.071392) [&95%={0.211617, 0.617533}]: 1.014036, ((Eosp: 0.946259, (Ldah: 0.492319, Etic: 0.492319) [&95%={0.256267, 0.792326}]: 0.453940) [&95%={0.662401, 1.25751}]: 0.200535, ((Mesp: 0.395340, Etex: 0.395340) [&95%={0.204383, 0.654474}]: 0.422721, (Puru: 0.373784, (Lpar: 0.195066, Lbir: 0.195066) [&95%={0.0979167, 0.342675}]: 0.178718) [&95%={0.224651, 0.583563}]: 0.444278) [&95%={0.578456, 1.11411}]: 0.328732) [&95%={0.879065, 1.48532}]: 0.239273) [&95%={1.07467, 1.75469}]: 1.198566, ((Chis: 0.533181, C146: 0.533181) [&95%={0.249461, 0.988192}]: 1.522667, (Scry: 1.746470, ((Pped: 1.154910, (Pleu: 0.656304, Enor: 0.656304) [&95%={0.366702, 0.983572}]: 0.498606) [&95%={0.850184, 1.41319}]: 0.435528, ((Bosp: 1.010615, (Elam: 0.144883, Aema: 0.144883) [&95%={0.0686215, 0.273411}]: 0.865732) [&95%={0.670336, 1.26609}]: 0.408303, (Mosp: 1.088681, (Masp: 0.959763, ((Cqua: 0.610416, (Svet: 0.222972, Smuc: 0.222972) [&95%={0.116499, 0.36949}]: 0.387444) [&95%={0.433069, 0.801926}]: 0.152172, (Dmag: 0.490721, (Dgal: 0.272830, (Dpul: 0.039483, Dpli: 0.039483) [&95%={0.0183203, 0.0755962}]: 0.233347) [&95%={0.150985, 0.434955}]: 0.217892) [&95%={0.329441, 0.68024}]: 0.271867) [&95%={0.588221, 0.949893}]: 0.197175) [&95%={0.768085, 1.14641}]: 0.128918) [&95%={0.888471, 1.26362}]: 0.330237) [&95%={1.22793, 1.55935}]: 0.171520) [&95%={1.44521, 1.68289}]: 0.156032) [&95%={1.73168, 1.7732}]: 0.309378) [&95%={1.85483, 2.40355}]: 0.528785) [&95%={2.17856, 3.10576}]: 0.808090) [&95%={2.83985, 3.81931}]: 0.673356) [&95%={4.05065, 4.09525}]: 0.849673) [&95%={4.73423, 5.26081}];","END;"))
nolysp.tree <- readMCMCtree(nolysp.tree, from.file = FALSE)



dates <- as.data.frame(cbind(all.tree$nodeAges[,1],no1.tree$nodeAges[,1],no2.tree$nodeAges[,1],no3.tree$nodeAges[,1],no4.tree$nodeAges[,1]))
colnames(dates) <- c("mean_all","mean_no1","mean_no2","mean_no3","mean_no4")
dates <- dates[!(row.names(dates) %in% c("50")),]
library(ggplot2)
plot1 <- ggplot(dates,aes(x=mean_all*100, y=mean_no1*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Anostraca Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Anostraca calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no1.tree$nodeAges[!(row.names(no1.tree$nodeAges) %in% c("50")),2]*100, ymax=no1.tree$nodeAges[!(row.names(no1.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))
plot2 <- ggplot(dates,aes(x=mean_all*100, y=mean_no2*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Notostraca Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Notostraca calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no2.tree$nodeAges[!(row.names(no2.tree$nodeAges) %in% c("50")),2]*100, ymax=no2.tree$nodeAges[!(row.names(no2.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))
plot3 <- ggplot(dates,aes(x=mean_all*100, y=mean_no3*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Cladocera Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Cladocera calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no3.tree$nodeAges[!(row.names(no3.tree$nodeAges) %in% c("50")),2]*100, ymax=no3.tree$nodeAges[!(row.names(no3.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


plot4 <- ggplot(dates,aes(x=mean_all*100, y=mean_no4*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Branchiopoda Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Branchiopoda calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no4.tree$nodeAges[!(row.names(no4.tree$nodeAges) %in% c("50")),2]*100, ymax=no4.tree$nodeAges[!(row.names(no4.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


dates_allvslysp<-read.table(file="../branchio_subsets/subsets_mcmctree/tmp.txt",sep=" ",header=T)
rownames(dates_allvslysp)<-dates_allvslysp$ID
dates_allvslysp<-dates_allvslysp[-2,-1]


plot5 <- ggplot(dates_allvslysp,aes(x=mean*100, y=mean_nolysp*100)) +
  geom_point() +
  ggtitle("All Species Dataset vs Dataset without Lynceus sp.") +
  labs(x = "Date estimates with all species", y = "Date estimates without Lynceus sp.") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=dates_allvslysp$X95._lower*100, xmax=dates_allvslysp$X95._upper*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=dates_allvslysp$X95._lower_nolysp*100, ymax=dates_allvslysp$X95._upper_nolysp*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))

# ALL TREE
all.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.848493, Iele: 4.848493) [&95%={3.81246, 5.69126}]: 0.324486, (((Blyn: 0.183483, Blin: 0.183483) [&95%={0.0847524, 0.349781}]: 1.091604, (Afr1: 1.053374, (Bher: 0.741404, (Stsp: 0.599355, Tpla: 0.599355) [&95%={0.385747, 0.817728}]: 0.142049) [&95%={0.52585, 0.944749}]: 0.311971) [&95%={0.870009, 1.18177}]: 0.221713) [&95%={1.25791, 1.30601}]: 2.790971, (((Tlon: 0.459209, (Tita: 0.042333, (Tusa: 0.004908, Tjap: 0.004908) [&95%={0.0022087, 0.0097336}]: 0.037426) [&95%={0.0206915, 0.0803842}]: 0.416876) [&95%={0.222185, 0.809971}]: 0.772728, ((Lcry: 0.075381, Lpac: 0.075381) [&95%={0.0350263, 0.140941}]: 0.164834, (Lubb: 0.087096, (Lapu: 0.072839, (Lcou: 0.036019, Lart: 0.036019) [&95%={0.0183237, 0.0626149}]: 0.036820) [&95%={0.0440445, 0.113719}]: 0.014257) [&95%={0.055115, 0.131698}]: 0.153118) [&95%={0.145528, 0.39566}]: 0.991722) [&95%={1.21848, 1.25871}]: 2.216226, (Lysp: 2.978259, (((Orub: 0.372016, (Ozsp: 0.300488, Cpil: 0.300488) [&95%={0.152237, 0.534596}]: 0.071528) [&95%={0.211772, 0.619124}]: 1.024664, ((Eosp: 0.951087, (Ldah: 0.493508, Etic: 0.493508) [&95%={0.265791, 0.788934}]: 0.457579) [&95%={0.672564, 1.26007}]: 0.203246, ((Mesp: 0.397918, Etex: 0.397918) [&95%={0.20474, 0.663208}]: 0.425019, (Puru: 0.376573, (Lpar: 0.197297, Lbir: 0.197297) [&95%={0.0980009, 0.346929}]: 0.179276) [&95%={0.226598, 0.587721}]: 0.446364) [&95%={0.574762, 1.13005}]: 0.331396) [&95%={0.886453, 1.49986}]: 0.242347) [&95%={1.08254, 1.80194}]: 1.154947, ((Chis: 0.525988, C146: 0.525988) [&95%={0.237675, 0.991174}]: 1.529127, (Scry: 1.746552, ((Pped: 1.159143, (Pleu: 0.661385, Enor: 0.661385) [&95%={0.372042, 0.985747}]: 0.497758) [&95%={0.85386, 1.41609}]: 0.433512, ((Bosp: 1.006935, (Elam: 0.145816, Aema: 0.145816) [&95%={0.0676681, 0.274699}]: 0.861119) [&95%={0.673296, 1.26163}]: 0.412320, (Mosp: 1.094142, (Masp: 0.966069, ((Cqua: 0.614324, (Svet: 0.224113, Smuc: 0.224113) [&95%={0.117718, 0.372385}]: 0.390211) [&95%={0.438641, 0.808974}]: 0.153198, (Dmag: 0.492747, (Dgal: 0.272179, (Dpul: 0.039349, Dpli: 0.039349) [&95%={0.0183865, 0.0755922}]: 0.232831) [&95%={0.152902, 0.435399}]: 0.220567) [&95%={0.332394, 0.690697}]: 0.274775) [&95%={0.592739, 0.958237}]: 0.198547) [&95%={0.773892, 1.15275}]: 0.128074) [&95%={0.894723, 1.26377}]: 0.325113) [&95%={1.23094, 1.55686}]: 0.173400) [&95%={1.44829, 1.68431}]: 0.153897) [&95%={1.73162, 1.77298}]: 0.308563) [&95%={1.85787, 2.38454}]: 0.496512) [&95%={2.18149, 3.0067}]: 0.426632) [&95%={2.51761, 3.4421}]: 0.469904) [&95%={2.95025, 3.83046}]: 0.617896) [&95%={4.05064, 4.09476}]: 1.106920) [&95%={4.88981, 5.85287}];","END;"))
all.tree <- readMCMCtree(all.tree, from.file = FALSE)
# NO LYSP TREE
nolysp.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.863927, Iele: 4.863927) [&95%={3.88285, 5.70173}]: 0.313904, (((Blyn: 0.185796, Blin: 0.185796) [&95%={0.0859153, 0.359523}]: 1.089322, (Afr1: 1.052181, (Bher: 0.740522, (Stsp: 0.596549, Tpla: 0.596549) [&95%={0.381851, 0.811702}]: 0.143973) [&95%={0.525174, 0.945344}]: 0.311659) [&95%={0.871331, 1.18206}]: 0.222937) [&95%={1.25783, 1.30522}]: 2.790947, (((Tlon: 0.462743, (Tita: 0.042857, (Tusa: 0.005018, Tjap: 0.005018) [&95%={0.0022232, 0.010016}]: 0.037839) [&95%={0.0207187, 0.0815595}]: 0.419886) [&95%={0.226565, 0.814679}]: 0.769169, ((Lcry: 0.074765, Lpac: 0.074765) [&95%={0.0342813, 0.142224}]: 0.165278, (Lubb: 0.087057, (Lapu: 0.072738, (Lcou: 0.035859, Lart: 0.035859) [&95%={0.0177628, 0.0632671}]: 0.036879) [&95%={0.0431455, 0.115726}]: 0.014319) [&95%={0.0542813, 0.13529}]: 0.152985) [&95%={0.143118, 0.400942}]: 0.991870) [&95%={1.21847, 1.25873}]: 2.156051, (((Orub: 0.374726, (Ozsp: 0.302196, Cpil: 0.302196) [&95%={0.153425, 0.527601}]: 0.072530) [&95%={0.21168, 0.61624}]: 1.026867, ((Eosp: 0.956916, (Ldah: 0.499109, Etic: 0.499109) [&95%={0.264269, 0.803469}]: 0.457807) [&95%={0.674988, 1.26388}]: 0.203197, ((Mesp: 0.401734, Etex: 0.401734) [&95%={0.208998, 0.669816}]: 0.425390, (Puru: 0.378251, (Lpar: 0.197017, Lbir: 0.197017) [&95%={0.0978702, 0.348621}]: 0.181234) [&95%={0.223907, 0.596541}]: 0.448873) [&95%={0.572868, 1.12573}]: 0.332990) [&95%={0.885692, 1.49981}]: 0.241480) [&95%={1.07961, 1.76398}]: 1.185227, ((Chis: 0.532700, C146: 0.532700) [&95%={0.240379, 0.98622}]: 1.524170, (Scry: 1.746539, ((Pped: 1.155797, (Pleu: 0.655812, Enor: 0.655812) [&95%={0.361964, 0.984675}]: 0.499985) [&95%={0.844007, 1.41379}]: 0.435354, ((Bosp: 1.007536, (Elam: 0.146766, Aema: 0.146766) [&95%={0.0678127, 0.277698}]: 0.860771) [&95%={0.67428, 1.26327}]: 0.412950, (Mosp: 1.094001, (Masp: 0.964201, ((Cqua: 0.615330, (Svet: 0.227503, Smuc: 0.227503) [&95%={0.120217, 0.37481}]: 0.387826) [&95%={0.436267, 0.809836}]: 0.152218, (Dmag: 0.492481, (Dgal: 0.272142, (Dpul: 0.039921, Dpli: 0.039921) [&95%={0.0182227, 0.0764653}]: 0.232221) [&95%={0.152323, 0.434471}]: 0.220338) [&95%={0.326218, 0.686956}]: 0.275067) [&95%={0.591468, 0.955047}]: 0.196654) [&95%={0.772493, 1.15132}]: 0.129800) [&95%={0.892096, 1.26519}]: 0.326485) [&95%={1.22873, 1.55914}]: 0.170665) [&95%={1.44637, 1.68347}]: 0.155387) [&95%={1.73168, 1.77323}]: 0.310331) [&95%={1.854, 2.41957}]: 0.529950) [&95%={2.18109, 3.12629}]: 0.801143) [&95%={2.81035, 3.82134}]: 0.678101) [&95%={4.05059, 4.09493}]: 1.111767) [&95%={4.89022, 5.88492}];","END;"))
nolysp.tree <- readMCMCtree(nolysp.tree, from.file = FALSE)
# CONC vs DISC PLOT
# CONCORDANCE SUBSET
conc.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.658176, Iele: 4.658176) [&95%={3.95461, 5.12858}]: 0.236982, (((Blyn: 0.173543, Blin: 0.173543) [&95%={0.0838993, 0.32292}]: 1.101271, (Afr1: 1.003471, (Bher: 0.695799, (Stsp: 0.573941, Tpla: 0.573941) [&95%={0.361087, 0.792994}]: 0.121858) [&95%={0.481979, 0.904594}]: 0.307672) [&95%={0.808244, 1.15212}]: 0.271343) [&95%={1.25783, 1.3051}]: 2.791608, (((Tlon: 0.436791, (Tita: 0.043290, (Tusa: 0.002767, Tjap: 0.002767) [&95%={0.0010957, 0.0057673}]: 0.040523) [&95%={0.0212793, 0.0802606}]: 0.393501) [&95%={0.221402, 0.75786}]: 0.795011, ((Lcry: 0.063790, Lpac: 0.063790) [&95%={0.0333893, 0.11007}]: 0.084211, (Lubb: 0.083776, (Lapu: 0.068746, (Lcou: 0.038749, Lart: 0.038749) [&95%={0.0203682, 0.0660698}]: 0.029997) [&95%={0.042777, 0.105919}]: 0.015030) [&95%={0.0539207, 0.124838}]: 0.064224) [&95%={0.0981868, 0.2254}]: 1.083801) [&95%={1.21845, 1.25842}]: 2.186295, (Lysp: 2.990757, (((Orub: 0.307194, (Ozsp: 0.217296, Cpil: 0.217296) [&95%={0.113304, 0.379362}]: 0.089898) [&95%={0.180775, 0.492752}]: 1.030800, ((Eosp: 0.875298, (Ldah: 0.416615, Etic: 0.416615) [&95%={0.220141, 0.671814}]: 0.458682) [&95%={0.614497, 1.17288}]: 0.192084, ((Mesp: 0.316409, Etex: 0.316409) [&95%={0.165344, 0.533547}]: 0.416568, (Puru: 0.290695, (Lpar: 0.139867, Lbir: 0.139867) [&95%={0.0694217, 0.246189}]: 0.150828) [&95%={0.173118, 0.460828}]: 0.442283) [&95%={0.509826, 1.00743}]: 0.334404) [&95%={0.81721, 1.37173}]: 0.270612) [&95%={1.0372, 1.72407}]: 1.172424, ((Chis: 0.473360, C146: 0.473360) [&95%={0.228721, 0.87455}]: 1.578323, (Scry: 1.746429, ((Pped: 1.145554, (Pleu: 0.620128, Enor: 0.620128) [&95%={0.347155, 0.927119}]: 0.525426) [&95%={0.852557, 1.3821}]: 0.418973, ((Bosp: 1.033113, (Elam: 0.174969, Aema: 0.174969) [&95%={0.0836486, 0.319765}]: 0.858144) [&95%={0.726363, 1.26437}]: 0.347246, (Mosp: 1.067007, (Masp: 0.931409, ((Cqua: 0.593561, (Svet: 0.214977, Smuc: 0.214977) [&95%={0.117551, 0.347963}]: 0.378584) [&95%={0.432295, 0.771555}]: 0.123161, (Dmag: 0.477689, (Dgal: 0.248078, (Dpul: 0.035455, Dpli: 0.035455) [&95%={0.0169507, 0.0661883}]: 0.212622) [&95%={0.139681, 0.395482}]: 0.229612) [&95%={0.324664, 0.65741}]: 0.239032) [&95%={0.557674, 0.893607}]: 0.214687) [&95%={0.7504, 1.11807}]: 0.135598) [&95%={0.880946, 1.25109}]: 0.313353) [&95%={1.20392, 1.53248}]: 0.184168) [&95%={1.41422, 1.66666}]: 0.181901) [&95%={1.73162, 1.77336}]: 0.305254) [&95%={1.86519, 2.34935}]: 0.458734) [&95%={2.16988, 2.92673}]: 0.480340) [&95%={2.5598, 3.42445}]: 0.427339) [&95%={2.95818, 3.78503}]: 0.648326) [&95%={4.0506, 4.09603}]: 0.828735) [&95%={4.73156, 5.24009}];
","END;"))
conc.tree <- readMCMCtree(conc.tree, from.file = FALSE)
# DISCORDANCE SUBSET
disc.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.521248, Iele: 4.521248) [&95%={3.48921, 5.12532}]: 0.395764, (((Blyn: 0.187805, Blin: 0.187805) [&95%={0.0870338, 0.359114}]: 1.087259, (Afr1: 1.059711, (Bher: 0.745400, (Stsp: 0.601138, Tpla: 0.601138) [&95%={0.384456, 0.816305}]: 0.144262) [&95%={0.524916, 0.94753}]: 0.314311) [&95%={0.881502, 1.18529}]: 0.215354) [&95%={1.25783, 1.30573}]: 2.790951, (((Tlon: 0.470034, (Tita: 0.042200, (Tusa: 0.005356, Tjap: 0.005356) [&95%={0.0024313, 0.0104986}]: 0.036844) [&95%={0.0207614, 0.080528}]: 0.427834) [&95%={0.229624, 0.819061}]: 0.761906, ((Lcry: 0.074396, Lpac: 0.074396) [&95%={0.034341, 0.142378}]: 0.175924, (Lubb: 0.086842, (Lapu: 0.072578, (Lcou: 0.035187, Lart: 0.035187) [&95%={0.0179829, 0.0615036}]: 0.037391) [&95%={0.0436774, 0.114589}]: 0.014265) [&95%={0.0548622, 0.132681}]: 0.163478) [&95%={0.150775, 0.415316}]: 0.981620) [&95%={1.21846, 1.25881}]: 2.211494, (Lysp: 2.961206, (((Orub: 0.384732, (Ozsp: 0.316927, Cpil: 0.316927) [&95%={0.161235, 0.551867}]: 0.067804) [&95%={0.217512, 0.636723}]: 1.006594, ((Eosp: 0.958137, (Ldah: 0.503529, Etic: 0.503529) [&95%={0.270183, 0.808566}]: 0.454607) [&95%={0.679962, 1.26388}]: 0.200909, ((Mesp: 0.408836, Etex: 0.408836) [&95%={0.207957, 0.680164}]: 0.422988, (Puru: 0.389910, (Lpar: 0.207035, Lbir: 0.207035) [&95%={0.103358, 0.365358}]: 0.182875) [&95%={0.233037, 0.611905}]: 0.441914) [&95%={0.584932, 1.14113}]: 0.327221) [&95%={0.891339, 1.50434}]: 0.232280) [&95%={1.0753, 1.76963}]: 1.154832, ((Chis: 0.534099, C146: 0.534099) [&95%={0.244046, 0.989418}]: 1.514501, (Scry: 1.746541, ((Pped: 1.164161, (Pleu: 0.668145, Enor: 0.668145) [&95%={0.376343, 0.996087}]: 0.496017) [&95%={0.861203, 1.4237}]: 0.432755, ((Bosp: 1.001790, (Elam: 0.139024, Aema: 0.139024) [&95%={0.0641068, 0.261917}]: 0.862766) [&95%={0.656142, 1.26346}]: 0.424925, (Mosp: 1.095739, (Masp: 0.968235, ((Cqua: 0.616826, (Svet: 0.227996, Smuc: 0.227996) [&95%={0.119161, 0.379202}]: 0.388831) [&95%={0.437885, 0.809867}]: 0.156089, (Dmag: 0.493178, (Dgal: 0.275446, (Dpul: 0.040420, Dpli: 0.040420) [&95%={0.0184146, 0.0780544}]: 0.235026) [&95%={0.152924, 0.438643}]: 0.217732) [&95%={0.329218, 0.682699}]: 0.279737) [&95%={0.600945, 0.960314}]: 0.195320) [&95%={0.778568, 1.14977}]: 0.127504) [&95%={0.89837, 1.2643}]: 0.330976) [&95%={1.23292, 1.56471}]: 0.170201) [&95%={1.45894, 1.6866}]: 0.149625) [&95%={1.73162, 1.77287}]: 0.302059) [&95%={1.85381, 2.38955}]: 0.497557) [&95%={2.16431, 3.01898}]: 0.415049) [&95%={2.49114, 3.4417}]: 0.482229) [&95%={2.92809, 3.8367}]: 0.622580) [&95%={4.05059, 4.09471}]: 0.850997) [&95%={4.73438, 5.26154}];
","END;"))
disc.tree <- readMCMCtree(disc.tree, from.file = FALSE)

dates_concdisc <- as.data.frame(cbind(conc.tree$nodeAges[,1],disc.tree$nodeAges[,1],all.tree$nodeAges[,1]))
colnames(dates_concdisc) <- c("mean_conc","mean_disc","mean_all")
dates_concdisc<-dates_concdisc[-2,]
plot6 <- ggplot(dates_concdisc,aes(x=mean_conc*100, y=mean_disc*100)) +
  geom_point() +
  ggtitle("Concordance Dataset vs Discordance Dataset") +
  labs(x = "Date estimates with concordant genes", y = "Date estimates discordant genes") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=conc.tree$nodeAges[!(row.names(conc.tree$nodeAges) %in% c("50")),2]*100, xmax=conc.tree$nodeAges[!(row.names(conc.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=disc.tree$nodeAges[!(row.names(disc.tree$nodeAges) %in% c("50")),2]*100, ymax=disc.tree$nodeAges[!(row.names(disc.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


pdf("./Figure2.pdf", width = 8.27, height = 11.69)
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6, ncol = 2, labels = c("A", "", "", "","B","C"))
dev.off()



pdf("./Figure2_horizontal.pdf", width = 11.69, height = 8.27)
plot_grid(plot1,plot2,plot5,plot3,plot4,plot6,labels =c ("A","","B","","","C"),ncol=3)
dev.off()





# RIDGEPLOT OF CONFIDENCE INTERVALS IN EACH DATASET
# Needed datasets

all.tree.CI <- all.tree$nodeAges[,3] - all.tree$nodeAges[,2]
all.tree.CI <- cbind(all.tree.CI,rep("All calibration/genes/species",length(all.tree.CI)))
all.tree.CI <- all.tree.CI[-2,]

no1.tree.CI <- no1.tree$nodeAges[,3] - no1.tree$nodeAges[,2]
no1.tree.CI <- cbind(no1.tree.CI,rep("No Anostraca calibration",length(no1.tree.CI)))
no1.tree.CI <- no1.tree.CI[-2,]

no2.tree.CI <- no2.tree$nodeAges[,3] - no2.tree$nodeAges[,2]
no2.tree.CI <- cbind(no2.tree.CI,rep("No Notostraca calibration",length(no2.tree.CI)))
no2.tree.CI <- no2.tree.CI[-2,]

no3.tree.CI <- no3.tree$nodeAges[,3] - no3.tree$nodeAges[,2]
no3.tree.CI <- cbind(no3.tree.CI,rep("No Cladocera calibration",length(no3.tree.CI)))
no3.tree.CI <- no3.tree.CI[-2,]

no4.tree.CI <- no4.tree$nodeAges[,3] - no4.tree$nodeAges[,2]
no4.tree.CI <- cbind(no4.tree.CI,rep("No Branchiopoda calibration",length(no4.tree.CI)))
no4.tree.CI <- no4.tree.CI[-2,]

nolysp.tree.CI <- nolysp.tree$nodeAges[,3] - nolysp.tree$nodeAges[,2]
nolysp.tree.CI <- cbind(nolysp.tree.CI,rep("Wihout Lynceus sp.",length(nolysp.tree.CI)))
nolysp.tree.CI <- nolysp.tree.CI[-2,]

conc.tree.CI <- conc.tree$nodeAges[,3] - conc.tree$nodeAges[,2]
conc.tree.CI <- cbind(conc.tree.CI,rep("Concordant genes",length(conc.tree.CI)))
conc.tree.CI <- conc.tree.CI[-2,]

disc.tree.CI <- disc.tree$nodeAges[,3] - disc.tree$nodeAges[,2]
disc.tree.CI <- cbind(disc.tree.CI,rep("Discordant genes",length(disc.tree.CI)))
disc.tree.CI <- disc.tree.CI[-2,]

remove(CI_data)
CI <- as.vector(as.numeric(c(all.tree.CI[,1],no1.tree.CI[,1],no2.tree.CI[,1],no3.tree.CI[,1],no4.tree.CI[,1],nolysp.tree.CI[,1],conc.tree.CI[,1],disc.tree.CI[,1])))
Dataset <- as.vector(as.factor(c(all.tree.CI[,2],no1.tree.CI[,2],no2.tree.CI[,2],no3.tree.CI[,2],no4.tree.CI[,2],nolysp.tree.CI[,2],conc.tree.CI[,2],disc.tree.CI[,2])))
CI_data <- data.frame(CI = CI, Dataset = Dataset, CI100 = CI*100)
CI_data$CI100 <- CI_data$CI*100

pastel_palette <- c("#FFB6C1", "#FFD700", "#98FB98", "#ADD8E6", "#FFA07A", "#D8BFD8", "#87CEEB", "#F0E68C")

pdf("./Confidence_Intervals_Ridgeplot.pdf", width = 11.69, height = 8.27)
ggplot(CI_data, aes(x = CI100, y = Dataset, fill = Dataset)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.5)) +
  scale_fill_manual(values = pastel_palette) +
  labs(x = "Confidence Intervals of Date Estimates (My)",y="")
dev.off()

# To check whether there is a "Group" (in our case prior/dataset) effect on the distribution
# of the confidence intervals sizes
shapiro.test(CI_data$CI100)
kruskal.test(CI_data$CI100,CI_data$Dataset)