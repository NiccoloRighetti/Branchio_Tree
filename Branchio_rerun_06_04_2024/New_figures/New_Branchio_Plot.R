# BRANCHIO PLOTTING
# Needed packages
suppressWarnings({
  library(MCMCtreeR, quietly = TRUE, warn.conflicts = FALSE)
  library(readr)
  library(ape)
  library(scales)
  library(ggplot2)
  library(tm)
  library(gridExtra)
  library(fmsb)
  library(devtools)
  library(ggradar)
  library(cowplot)
  library(dplyr)
  library(magick)
  library(grImport2)
  library(ggridges)
  library(viridis)
  library(forcats)
})

cat("All required packages have been successfully loaded.\n")


#FIGURA 1
branchiopoda_occ <- read.table("./branchiopoda_occ.txt", sep=",", header = T)
branchiopoda_occ <- cbind(rep("Branchiopoda",length(branchiopoda_occ[1])),branchiopoda_occ)
colnames(branchiopoda_occ)[1] <- "Group"

mean_value_crown <- 406.5917
min_value_crown <- 405.06000
max_value_crown <- 409.4840
mean_value_stem <- 495.8419
min_value_stem <- 473.972
max_value_stem <- 528.311
plot_branchio <- ggplot(branchiopoda_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect", xmin = 405.06, xmax = 409.4840, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 473.972, xmax = 528.311, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#B87333",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

cladocera_occ <- read.table("./cladocera_occ.txt", sep=",", header = T)
cladocera_occ <- cbind(rep("Cladocera",length(cladocera_occ[1])),cladocera_occ)
colnames(cladocera_occ)[1] <- "Group"

mean_value_crown <- 174.5135
min_value_crown <-  173.15200
max_value_crown <- 177.0820
mean_value_stem <- 195.7127
min_value_stem <- 183.13900
max_value_stem <- 222.7480
plot_clado <- ggplot(cladocera_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect",xmin = 173.15200, xmax = 177.0820, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect",xmin = 183.13900, xmax = 222.7480, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#FF6347",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

notostraca_occ <- read.table("./notostraca_occ.txt", sep=",", header = T)
notostraca_occ <- cbind(rep("Notostraca",length(notostraca_occ[1])),notostraca_occ)
colnames(notostraca_occ)[1] <- "Group"

mean_value_crown <- 123.5135
min_value_crown <-  121.87200
max_value_crown <- 126.5260
mean_value_stem <- 322.2284
min_value_stem <- 252.25600
max_value_stem <- 376.6370
plot_noto <- ggplot(notostraca_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect",xmin = 121.87200, xmax = 126.5260, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 252.25600, xmax = 376.6370, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#DAA520",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

anostraca_occ <- read.table("./anostraca_occ.txt", sep=",", header = T)
anostraca_occ <- cbind(rep("Anostraca",length(anostraca_occ[1])),anostraca_occ)
colnames(anostraca_occ)[1] <- "Group"

mean_value_crown <- 127.3788
min_value_crown <-  125.78200
max_value_crown <- 130.3390
mean_value_stem <- 406.5917
min_value_stem <- 405.06000
max_value_stem <- 409.4840
plot_anos <- ggplot(anostraca_occ, aes(x = max_ma, fill = Group)) +
  ggplot2::annotate(geom = "rect", xmin = 125.78200, xmax = 130.3390, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 405.06000, xmax = 409.4840, ymin = 0, ymax = Inf,
            fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#008080",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")

anostraca_2_occ <- read.table("./anostraca_occ.txt", sep=",", header = T)
anostraca_2_occ <- cbind(rep("Branchiopoda",length(anostraca_2_occ[1])),anostraca_2_occ)
colnames(anostraca_2_occ)[1] <- "Group"
branchio_anos_occ <- rbind(branchiopoda_occ,anostraca_2_occ)


plot_branchio_anos <- ggplot(branchio_anos_occ, aes(x = max_ma)) +
  ggplot2::annotate(geom = "rect", xmin = 125.78200, xmax = 130.3390, ymin = 0, ymax = Inf,
                    fill = "grey68", alpha = 0.5) +
  ggplot2::annotate(geom = "rect", xmin = 405.06000, xmax = 409.4840, ymin = 0, ymax = Inf,
                    fill = "grey68", alpha = 0.5) +
  geom_histogram(position = "stack", bins = 50,fill="#B87333",color="white") +
  theme_bw() +
  scale_x_reverse() +
  xlim(550, 0) +
  facet_wrap(~Group, scales = "free_y", ncol = 1) + 
  theme(strip.background = element_blank(), legend.position = "none")


pdf("./fossils_occurences.pdf", width = 11.7, height = 8.3)
plot_grid(plot_branchio_anos,plot_anos,plot_noto,plot_clado,ncol=1)
dev.off()


complete_dataset <- rbind(branchio_anos_occ,anostraca_occ,notostraca_occ,cladocera_occ)

complete_dataset$Ma_Bin <- cut(complete_dataset$max_ma, breaks = seq(0, max(complete_dataset$max_ma) + 50, by = 50), labels = FALSE)

count_df <- complete_dataset %>%
  group_by(Group, Ma_Bin) %>%
  summarize(Count = n())

count_df$Ma_Bin <- paste0((as.numeric(count_df$Ma_Bin) - 1) * 50, "-", as.numeric(count_df$Ma_Bin) * 50, "Ma")

count_df <- count_df[order(count_df$Group, count_df$Ma_Bin),]

count_df <- as.data.frame(count_df)


order_vector <- c("0-50Ma", "50-100Ma", "100-150Ma", "150-200Ma", "200-250Ma", "250-300Ma", 
                  "300-350Ma", "350-400Ma", "400-450Ma", "450-500Ma", "500-550Ma")
order_vector <- rev(order_vector)

count_df$Ma_Bin <- factor(count_df$Ma_Bin, levels = order_vector)

desired_order <- c("Cladocera", "Notostraca", "Anostraca", "Branchiopoda")

plot_fossils_circle <- ggplot(count_df, aes(x = Ma_Bin, y = fct_inorder(Group), color = Count, size = Count)) +
  geom_point() +
  scale_colour_viridis_c(name = "Count") +
  scale_size_continuous(range = c(1, 25), name = "Count") +
  theme(legend.position = "bottom") +
  guides(color = guide_legend(), size = guide_legend()) +
  theme_bw() +
  labs(x = "", y = "")

# Order the levels of the 'Group' variable according to 'desired_order'
plot_fossils_circle <- plot_fossils_circle + 
  scale_y_discrete(limits = desired_order)


pdf("./fossils_occurences_circles.pdf", width = 11.7, height = 5.3)
plot_fossils_circle
dev.off()




# JACKKNIFE PLOT
# All fossils
all.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.848493, Iele: 4.848493) [&95%={3.81246, 5.69126}]: 0.324486, (((Blyn: 0.183483, Blin: 0.183483) [&95%={0.0847524, 0.349781}]: 1.091604, (Afr1: 1.053374, (Bher: 0.741404, (Stsp: 0.599355, Tpla: 0.599355) [&95%={0.385747, 0.817728}]: 0.142049) [&95%={0.52585, 0.944749}]: 0.311971) [&95%={0.870009, 1.18177}]: 0.221713) [&95%={1.25791, 1.30601}]: 2.790971, (((Tlon: 0.459209, (Tita: 0.042333, (Tusa: 0.004908, Tjap: 0.004908) [&95%={0.0022087, 0.0097336}]: 0.037426) [&95%={0.0206915, 0.0803842}]: 0.416876) [&95%={0.222185, 0.809971}]: 0.772728, ((Lcry: 0.075381, Lpac: 0.075381) [&95%={0.0350263, 0.140941}]: 0.164834, (Lubb: 0.087096, (Lapu: 0.072839, (Lcou: 0.036019, Lart: 0.036019) [&95%={0.0183237, 0.0626149}]: 0.036820) [&95%={0.0440445, 0.113719}]: 0.014257) [&95%={0.055115, 0.131698}]: 0.153118) [&95%={0.145528, 0.39566}]: 0.991722) [&95%={1.21848, 1.25871}]: 2.216226, (Lysp: 2.978259, (((Orub: 0.372016, (Ozsp: 0.300488, Cpil: 0.300488) [&95%={0.152237, 0.534596}]: 0.071528) [&95%={0.211772, 0.619124}]: 1.024664, ((Eosp: 0.951087, (Ldah: 0.493508, Etic: 0.493508) [&95%={0.265791, 0.788934}]: 0.457579) [&95%={0.672564, 1.26007}]: 0.203246, ((Mesp: 0.397918, Etex: 0.397918) [&95%={0.20474, 0.663208}]: 0.425019, (Puru: 0.376573, (Lpar: 0.197297, Lbir: 0.197297) [&95%={0.0980009, 0.346929}]: 0.179276) [&95%={0.226598, 0.587721}]: 0.446364) [&95%={0.574762, 1.13005}]: 0.331396) [&95%={0.886453, 1.49986}]: 0.242347) [&95%={1.08254, 1.80194}]: 1.154947, ((Chis: 0.525988, C146: 0.525988) [&95%={0.237675, 0.991174}]: 1.529127, (Scry: 1.746552, ((Pped: 1.159143, (Pleu: 0.661385, Enor: 0.661385) [&95%={0.372042, 0.985747}]: 0.497758) [&95%={0.85386, 1.41609}]: 0.433512, ((Bosp: 1.006935, (Elam: 0.145816, Aema: 0.145816) [&95%={0.0676681, 0.274699}]: 0.861119) [&95%={0.673296, 1.26163}]: 0.412320, (Mosp: 1.094142, (Masp: 0.966069, ((Cqua: 0.614324, (Svet: 0.224113, Smuc: 0.224113) [&95%={0.117718, 0.372385}]: 0.390211) [&95%={0.438641, 0.808974}]: 0.153198, (Dmag: 0.492747, (Dgal: 0.272179, (Dpul: 0.039349, Dpli: 0.039349) [&95%={0.0183865, 0.0755922}]: 0.232831) [&95%={0.152902, 0.435399}]: 0.220567) [&95%={0.332394, 0.690697}]: 0.274775) [&95%={0.592739, 0.958237}]: 0.198547) [&95%={0.773892, 1.15275}]: 0.128074) [&95%={0.894723, 1.26377}]: 0.325113) [&95%={1.23094, 1.55686}]: 0.173400) [&95%={1.44829, 1.68431}]: 0.153897) [&95%={1.73162, 1.77298}]: 0.308563) [&95%={1.85787, 2.38454}]: 0.496512) [&95%={2.18149, 3.0067}]: 0.426632) [&95%={2.51761, 3.4421}]: 0.469904) [&95%={2.95025, 3.83046}]: 0.617896) [&95%={4.05064, 4.09476}]: 1.106920) [&95%={4.88981, 5.85287}];","END;"))
all.tree <- readMCMCtree(all.tree, from.file = FALSE)
# No 1
no1.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.847654, Iele: 4.847654) [&95%={3.78012, 5.6864}]: 0.332327, (((Blyn: 0.196926, Blin: 0.196926) [&95%={0.0895838, 0.382144}]: 1.503277, (Afr1: 1.360335, (Bher: 0.918509, (Stsp: 0.752524, Tpla: 0.752524) [&95%={0.44152, 1.11529}]: 0.165985) [&95%={0.589823, 1.28465}]: 0.441826) [&95%={0.940416, 1.92559}]: 0.339868) [&95%={1.19414, 2.41336}]: 2.365952, (((Tlon: 0.476667, (Tita: 0.044168, (Tusa: 0.005081, Tjap: 0.005081) [&95%={0.0023315, 0.0098643}]: 0.039087) [&95%={0.0217414, 0.0833259}]: 0.432500) [&95%={0.240143, 0.817759}]: 0.756201, ((Lcry: 0.077535, Lpac: 0.077535) [&95%={0.0363409, 0.144262}]: 0.171231, (Lubb: 0.090282, (Lapu: 0.075588, (Lcou: 0.037282, Lart: 0.037282) [&95%={0.0192191, 0.064993}]: 0.038306) [&95%={0.0458805, 0.119072}]: 0.014694) [&95%={0.0571041, 0.137052}]: 0.158483) [&95%={0.150745, 0.407278}]: 0.984103) [&95%={1.21855, 1.26075}]: 2.234118, (Lysp: 2.999641, (((Orub: 0.386785, (Ozsp: 0.312971, Cpil: 0.312971) [&95%={0.160381, 0.549086}]: 0.073814) [&95%={0.219266, 0.64007}]: 1.074789, ((Eosp: 0.993967, (Ldah: 0.517405, Etic: 0.517405) [&95%={0.273977, 0.825345}]: 0.476562) [&95%={0.70124, 1.32631}]: 0.209403, ((Mesp: 0.412318, Etex: 0.412318) [&95%={0.212911, 0.678204}]: 0.442334, (Puru: 0.390161, (Lpar: 0.202751, Lbir: 0.202751) [&95%={0.101109, 0.353611}]: 0.187409) [&95%={0.234625, 0.607989}]: 0.464491) [&95%={0.595803, 1.16891}]: 0.348718) [&95%={0.91103, 1.54714}]: 0.258204) [&95%={1.1111, 1.83844}]: 1.109260, ((Chis: 0.541709, C146: 0.541709) [&95%={0.258674, 0.985609}]: 1.524163, (Scry: 1.746819, ((Pped: 1.163081, (Pleu: 0.662344, Enor: 0.662344) [&95%={0.373642, 0.989155}]: 0.500738) [&95%={0.858004, 1.43684}]: 0.435438, ((Bosp: 1.008221, (Elam: 0.150632, Aema: 0.150632) [&95%={0.0707006, 0.280742}]: 0.857589) [&95%={0.691327, 1.2547}]: 0.422690, (Mosp: 1.099193, (Masp: 0.970071, ((Cqua: 0.616963, (Svet: 0.230944, Smuc: 0.230944) [&95%={0.123421, 0.380461}]: 0.386020) [&95%={0.445162, 0.795219}]: 0.155725, (Dmag: 0.498532, (Dgal: 0.277293, (Dpul: 0.040688, Dpli: 0.040688) [&95%={0.0189193, 0.0771872}]: 0.236605) [&95%={0.155563, 0.439527}]: 0.221239) [&95%={0.332249, 0.682149}]: 0.274156) [&95%={0.605457, 0.94572}]: 0.197383) [&95%={0.789679, 1.13939}]: 0.129122) [&95%={0.914679, 1.26343}]: 0.331718) [&95%={1.26151, 1.55687}]: 0.167609) [&95%={1.47401, 1.6832}]: 0.148299) [&95%={1.7317, 1.77374}]: 0.319054) [&95%={1.86288, 2.40781}]: 0.504962) [&95%={2.2032, 3.02453}]: 0.428807) [&95%={2.54627, 3.4497}]: 0.467345) [&95%={2.98242, 3.82823}]: 0.599168) [&95%={4.05061, 4.09556}]: 1.113826) [&95%={4.89439, 5.86813}];","END;"))
no1.tree <- readMCMCtree(no1.tree, from.file = FALSE)
# No 2
no2.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.859456, Iele: 4.859456) [&95%={3.87663, 5.68594}]: 0.304073, (((Blyn: 0.179697, Blin: 0.179697) [&95%={0.0841039, 0.3366}]: 1.093567, (Afr1: 1.052496, (Bher: 0.739346, (Stsp: 0.599299, Tpla: 0.599299) [&95%={0.388255, 0.813841}]: 0.140046) [&95%={0.523262, 0.940544}]: 0.313150) [&95%={0.877232, 1.17865}]: 0.220769) [&95%={1.25776, 1.30244}]: 2.792747, (((Tlon: 0.400053, (Tita: 0.040981, (Tusa: 0.004768, Tjap: 0.004768) [&95%={0.0021867, 0.0092884}]: 0.036213) [&95%={0.020224, 0.0765809}]: 0.359072) [&95%={0.204966, 0.705432}]: 0.548803, ((Lcry: 0.072309, Lpac: 0.072309) [&95%={0.0343432, 0.135834}]: 0.153248, (Lubb: 0.083997, (Lapu: 0.070239, (Lcou: 0.034699, Lart: 0.034699) [&95%={0.0178516, 0.0609236}]: 0.035540) [&95%={0.0426431, 0.110906}]: 0.013758) [&95%={0.0533793, 0.128482}]: 0.141561) [&95%={0.139314, 0.36252}]: 0.723299) [&95%={0.588157, 1.43317}]: 2.480627, (Lysp: 2.961370, (((Orub: 0.363628, (Ozsp: 0.294233, Cpil: 0.294233) [&95%={0.153169, 0.510113}]: 0.069395) [&95%={0.208362, 0.590273}]: 1.006995, ((Eosp: 0.936951, (Ldah: 0.486728, Etic: 0.486728) [&95%={0.260819, 0.778396}]: 0.450223) [&95%={0.662854, 1.24975}]: 0.197000, ((Mesp: 0.391813, Etex: 0.391813) [&95%={0.20285, 0.653078}]: 0.417109, (Puru: 0.369165, (Lpar: 0.191790, Lbir: 0.191790) [&95%={0.0968816, 0.338535}]: 0.177375) [&95%={0.221296, 0.579144}]: 0.439758) [&95%={0.564243, 1.11773}]: 0.325029) [&95%={0.869238, 1.47934}]: 0.236672) [&95%={1.06172, 1.74811}]: 1.168012, ((Chis: 0.517577, C146: 0.517577) [&95%={0.241301, 0.964638}]: 1.531708, (Scry: 1.746420, ((Pped: 1.148341, (Pleu: 0.647602, Enor: 0.647602) [&95%={0.360166, 0.972043}]: 0.500740) [&95%={0.834949, 1.41939}]: 0.441061, ((Bosp: 0.999821, (Elam: 0.142446, Aema: 0.142446) [&95%={0.0671551, 0.267295}]: 0.857375) [&95%={0.674537, 1.25717}]: 0.414252, (Mosp: 1.080786, (Masp: 0.953544, ((Cqua: 0.607117, (Svet: 0.220062, Smuc: 0.220062) [&95%={0.116699, 0.359375}]: 0.387054) [&95%={0.433115, 0.794284}]: 0.150629, (Dmag: 0.488156, (Dgal: 0.268929, (Dpul: 0.038298, Dpli: 0.038298) [&95%={0.0177627, 0.0727656}]: 0.230631) [&95%={0.149582, 0.427546}]: 0.219227) [&95%={0.326194, 0.670914}]: 0.269589) [&95%={0.584769, 0.936726}]: 0.195798) [&95%={0.762244, 1.13185}]: 0.127242) [&95%={0.887479, 1.25216}]: 0.333287) [&95%={1.22142, 1.5554}]: 0.175330) [&95%={1.44469, 1.6814}]: 0.157017) [&95%={1.73164, 1.7731}]: 0.302866) [&95%={1.85744, 2.37993}]: 0.489350) [&95%={2.16962, 3.00018}]: 0.422735) [&95%={2.50211, 3.43468}]: 0.468114) [&95%={2.91717, 3.82414}]: 0.636528) [&95%={4.05063, 4.09593}]: 1.097518) [&95%={4.88978, 5.85122}];","END;"))
no2.tree <- readMCMCtree(no2.tree, from.file = FALSE)
# No 3
no3.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.819732, Iele: 4.819732) [&95%={3.69816, 5.69633}]: 0.357624, (((Blyn: 0.193876, Blin: 0.193876) [&95%={0.0934429, 0.360428}]: 1.081683, (Afr1: 1.056880, (Bher: 0.749357, (Stsp: 0.604184, Tpla: 0.604184) [&95%={0.396935, 0.80743}]: 0.145173) [&95%={0.54445, 0.942273}]: 0.307523) [&95%={0.889662, 1.17882}]: 0.218679) [&95%={1.25791, 1.30646}]: 2.790837, (((Tlon: 0.475831, (Tita: 0.045185, (Tusa: 0.005194, Tjap: 0.005194) [&95%={0.0024441, 0.0098274}]: 0.039991) [&95%={0.0227574, 0.0836635}]: 0.430646) [&95%={0.240155, 0.808336}]: 0.757027, ((Lcry: 0.079501, Lpac: 0.079501) [&95%={0.0383345, 0.145855}]: 0.173999, (Lubb: 0.092500, (Lapu: 0.077559, (Lcou: 0.038148, Lart: 0.038148) [&95%={0.0199037, 0.0653943}]: 0.039411) [&95%={0.0476088, 0.121559}]: 0.014941) [&95%={0.0595605, 0.140395}]: 0.161000) [&95%={0.15616, 0.413204}]: 0.979358) [&95%={1.2185, 1.26069}]: 2.371995, (Lysp: 3.230609, (((Orub: 0.394610, (Ozsp: 0.319921, Cpil: 0.319921) [&95%={0.168101, 0.550784}]: 0.074689) [&95%={0.22754, 0.641185}]: 1.081407, ((Eosp: 0.988842, (Ldah: 0.518593, Etic: 0.518593) [&95%={0.283269, 0.818472}]: 0.470248) [&95%={0.709272, 1.28882}]: 0.212427, ((Mesp: 0.421812, Etex: 0.421812) [&95%={0.226592, 0.686651}]: 0.439669, (Puru: 0.395413, (Lpar: 0.206463, Lbir: 0.206463) [&95%={0.106395, 0.357154}]: 0.188950) [&95%={0.241779, 0.610601}]: 0.466068) [&95%={0.610853, 1.19587}]: 0.339788) [&95%={0.928745, 1.60859}]: 0.274749) [&95%={1.13314, 2.01544}]: 1.405970, ((Chis: 0.574524, C146: 0.574524) [&95%={0.271088, 1.05137}]: 1.915827, (Scry: 2.231680, ((Pped: 1.359800, (Pleu: 0.755470, Enor: 0.755470) [&95%={0.413223, 1.21461}]: 0.604330) [&95%={0.956251, 1.9018}]: 0.641021, ((Bosp: 1.170081, (Elam: 0.157950, Aema: 0.157950) [&95%={0.0752934, 0.294897}]: 1.012131) [&95%={0.79189, 1.60946}]: 0.585590, (Mosp: 1.249093, (Masp: 1.097723, ((Cqua: 0.694147, (Svet: 0.247142, Smuc: 0.247142) [&95%={0.132948, 0.404775}]: 0.447005) [&95%={0.492841, 0.913329}]: 0.171277, (Dmag: 0.549615, (Dgal: 0.300322, (Dpul: 0.041982, Dpli: 0.041982) [&95%={0.019687, 0.0800865}]: 0.258340) [&95%={0.169869, 0.477665}]: 0.249293) [&95%={0.373835, 0.758484}]: 0.315810) [&95%={0.671266, 1.08356}]: 0.232298) [&95%={0.892932, 1.31465}]: 0.151371) [&95%={1.03865, 1.52516}]: 0.506578) [&95%={1.44989, 2.11859}]: 0.245149) [&95%={1.66145, 2.38116}]: 0.230859) [&95%={1.86363, 2.63075}]: 0.258670) [&95%={2.09524, 2.89696}]: 0.391637) [&95%={2.46323, 3.27024}]: 0.348621) [&95%={2.81153, 3.58589}]: 0.374245) [&95%={3.21757, 3.87592}]: 0.461543) [&95%={4.0506, 4.0951}]: 1.110959) [&95%={4.89234, 5.87671}];","END;"))
no3.tree <- readMCMCtree(no3.tree, from.file = FALSE)
# No 4
no4.tree <- as.character(c("#NEXUS","begin trees",""," ((Scur: 4.748362, Iele: 4.748362) [&95%={3.55806, 5.65411}]: 0.444332, (((Blyn: 0.187378, Blin: 0.187378) [&95%={0.0849576, 0.36114}]: 1.087722, (Afr1: 1.054286, (Bher: 0.743175, (Stsp: 0.599877, Tpla: 0.599877) [&95%={0.384273, 0.817321}]: 0.143298) [&95%={0.527007, 0.950342}]: 0.311112) [&95%={0.872709, 1.18331}]: 0.220814) [&95%={1.25794, 1.30551}]: 3.068230, (((Tlon: 0.461486, (Tita: 0.043209, (Tusa: 0.004971, Tjap: 0.004971) [&95%={0.0022139, 0.0098688}]: 0.038238) [&95%={0.0208104, 0.0825883}]: 0.418277) [&95%={0.222255, 0.814338}]: 0.770470, ((Lcry: 0.075536, Lpac: 0.075536) [&95%={0.0353283, 0.142348}]: 0.166595, (Lubb: 0.088310, (Lapu: 0.073799, (Lcou: 0.036239, Lart: 0.036239) [&95%={0.0184033, 0.0642897}]: 0.037560) [&95%={0.0443384, 0.118358}]: 0.014511) [&95%={0.0554089, 0.137542}]: 0.153821) [&95%={0.147158, 0.401352}]: 0.989824) [&95%={1.21848, 1.25877}]: 2.360879, (Lysp: 3.069667, (((Orub: 0.374580, (Ozsp: 0.301815, Cpil: 0.301815) [&95%={0.152702, 0.534981}]: 0.072766) [&95%={0.211537, 0.622832}]: 1.031631, ((Eosp: 0.954492, (Ldah: 0.496391, Etic: 0.496391) [&95%={0.263513, 0.790898}]: 0.458100) [&95%={0.674192, 1.2658}]: 0.204458, ((Mesp: 0.403270, Etex: 0.403270) [&95%={0.205137, 0.665288}]: 0.422549, (Puru: 0.381664, (Lpar: 0.199011, Lbir: 0.199011) [&95%={0.0976003, 0.353158}]: 0.182653) [&95%={0.226929, 0.601758}]: 0.444155) [&95%={0.578793, 1.12915}]: 0.333131) [&95%={0.885877, 1.50289}]: 0.247261) [&95%={1.08526, 1.81599}]: 1.192598, ((Chis: 0.533622, C146: 0.533622) [&95%={0.251843, 0.988505}]: 1.534052, (Scry: 1.746581, ((Pped: 1.154007, (Pleu: 0.651682, Enor: 0.651682) [&95%={0.363128, 0.974105}]: 0.502326) [&95%={0.837092, 1.41426}]: 0.437185, ((Bosp: 1.001406, (Elam: 0.147886, Aema: 0.147886) [&95%={0.0680121, 0.280208}]: 0.853520) [&95%={0.672175, 1.26291}]: 0.417061, (Mosp: 1.096315, (Masp: 0.967769, ((Cqua: 0.615444, (Svet: 0.226685, Smuc: 0.226685) [&95%={0.119554, 0.375074}]: 0.388759) [&95%={0.435096, 0.811565}]: 0.154512, (Dmag: 0.494330, (Dgal: 0.272153, (Dpul: 0.039588, Dpli: 0.039588) [&95%={0.01793, 0.0765339}]: 0.232565) [&95%={0.149415, 0.436829}]: 0.222177) [&95%={0.327946, 0.687829}]: 0.275626) [&95%={0.595735, 0.962069}]: 0.197813) [&95%={0.776832, 1.15585}]: 0.128546) [&95%={0.89989, 1.26624}]: 0.322152) [&95%={1.22607, 1.55865}]: 0.172725) [&95%={1.44159, 1.68244}]: 0.155388) [&95%={1.7317, 1.77346}]: 0.321093) [&95%={1.85519, 2.4562}]: 0.531135) [&95%={2.17524, 3.22014}]: 0.470858) [&95%={2.5001, 3.84369}]: 0.523168) [&95%={2.89663, 4.44238}]: 0.750496) [&95%={3.45657, 5.24136}]: 0.849363) [&95%={4.89677, 5.88987}];","END;"))
no4.tree <- readMCMCtree(no4.tree, from.file = FALSE)
# No Lysp
nolysp.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.567391, Iele: 4.567391) [&95%={3.64554, 5.13013}]: 0.348361, (((Blyn: 0.184843, Blin: 0.184843) [&95%={0.0858299, 0.35493}]: 1.090215, (Afr1: 1.051796, (Bher: 0.741638, (Stsp: 0.598639, Tpla: 0.598639) [&95%={0.383803, 0.812534}]: 0.142999) [&95%={0.525328, 0.944971}]: 0.310158) [&95%={0.872574, 1.18086}]: 0.223263) [&95%={1.25792, 1.3051}]: 2.791021, (((Tlon: 0.462610, (Tita: 0.041969, (Tusa: 0.004952, Tjap: 0.004952) [&95%={0.0022598, 0.0097788}]: 0.037018) [&95%={0.0205872, 0.0784247}]: 0.420641) [&95%={0.220289, 0.809126}]: 0.769301, ((Lcry: 0.072841, Lpac: 0.072841) [&95%={0.0337677, 0.13588}]: 0.162456, (Lubb: 0.085198, (Lapu: 0.071107, (Lcou: 0.035190, Lart: 0.035190) [&95%={0.0180125, 0.0614742}]: 0.035917) [&95%={0.0431286, 0.112514}]: 0.014091) [&95%={0.0539564, 0.13048}]: 0.150099) [&95%={0.140888, 0.38818}]: 0.996614) [&95%={1.21846, 1.25891}]: 2.160812, (((Orub: 0.372032, (Ozsp: 0.300639, Cpil: 0.300639) [&95%={0.154036, 0.529116}]: 0.071392) [&95%={0.211617, 0.617533}]: 1.014036, ((Eosp: 0.946259, (Ldah: 0.492319, Etic: 0.492319) [&95%={0.256267, 0.792326}]: 0.453940) [&95%={0.662401, 1.25751}]: 0.200535, ((Mesp: 0.395340, Etex: 0.395340) [&95%={0.204383, 0.654474}]: 0.422721, (Puru: 0.373784, (Lpar: 0.195066, Lbir: 0.195066) [&95%={0.0979167, 0.342675}]: 0.178718) [&95%={0.224651, 0.583563}]: 0.444278) [&95%={0.578456, 1.11411}]: 0.328732) [&95%={0.879065, 1.48532}]: 0.239273) [&95%={1.07467, 1.75469}]: 1.198566, ((Chis: 0.533181, C146: 0.533181) [&95%={0.249461, 0.988192}]: 1.522667, (Scry: 1.746470, ((Pped: 1.154910, (Pleu: 0.656304, Enor: 0.656304) [&95%={0.366702, 0.983572}]: 0.498606) [&95%={0.850184, 1.41319}]: 0.435528, ((Bosp: 1.010615, (Elam: 0.144883, Aema: 0.144883) [&95%={0.0686215, 0.273411}]: 0.865732) [&95%={0.670336, 1.26609}]: 0.408303, (Mosp: 1.088681, (Masp: 0.959763, ((Cqua: 0.610416, (Svet: 0.222972, Smuc: 0.222972) [&95%={0.116499, 0.36949}]: 0.387444) [&95%={0.433069, 0.801926}]: 0.152172, (Dmag: 0.490721, (Dgal: 0.272830, (Dpul: 0.039483, Dpli: 0.039483) [&95%={0.0183203, 0.0755962}]: 0.233347) [&95%={0.150985, 0.434955}]: 0.217892) [&95%={0.329441, 0.68024}]: 0.271867) [&95%={0.588221, 0.949893}]: 0.197175) [&95%={0.768085, 1.14641}]: 0.128918) [&95%={0.888471, 1.26362}]: 0.330237) [&95%={1.22793, 1.55935}]: 0.171520) [&95%={1.44521, 1.68289}]: 0.156032) [&95%={1.73168, 1.7732}]: 0.309378) [&95%={1.85483, 2.40355}]: 0.528785) [&95%={2.17856, 3.10576}]: 0.808090) [&95%={2.83985, 3.81931}]: 0.673356) [&95%={4.05065, 4.09525}]: 0.849673) [&95%={4.73423, 5.26081}];","END;"))
nolysp.tree <- readMCMCtree(nolysp.tree, from.file = FALSE)



dates <- as.data.frame(cbind(all.tree$nodeAges[,1],no1.tree$nodeAges[,1],no2.tree$nodeAges[,1],no3.tree$nodeAges[,1],no4.tree$nodeAges[,1]))
colnames(dates) <- c("mean_all","mean_no1","mean_no2","mean_no3","mean_no4")
dates <- dates[!(row.names(dates) %in% c("50")),]
library(ggplot2)
plot1 <- ggplot(dates,aes(x=mean_all*100, y=mean_no1*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Anostraca Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Anostraca calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no1.tree$nodeAges[!(row.names(no1.tree$nodeAges) %in% c("50")),2]*100, ymax=no1.tree$nodeAges[!(row.names(no1.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))
plot2 <- ggplot(dates,aes(x=mean_all*100, y=mean_no2*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Notostraca Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Notostraca calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no2.tree$nodeAges[!(row.names(no2.tree$nodeAges) %in% c("50")),2]*100, ymax=no2.tree$nodeAges[!(row.names(no2.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))
plot3 <- ggplot(dates,aes(x=mean_all*100, y=mean_no3*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Cladocera Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Cladocera calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no3.tree$nodeAges[!(row.names(no3.tree$nodeAges) %in% c("50")),2]*100, ymax=no3.tree$nodeAges[!(row.names(no3.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


plot4 <- ggplot(dates,aes(x=mean_all*100, y=mean_no4*100)) +
  geom_point() +
  ggtitle("All Calibrations vs No Branchiopoda Calibration") +
  labs(x = "Date estimates with all calibrations", y = "Date estimates without Branchiopoda calibration") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),2]*100, xmax=all.tree$nodeAges[!(row.names(all.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=no4.tree$nodeAges[!(row.names(no4.tree$nodeAges) %in% c("50")),2]*100, ymax=no4.tree$nodeAges[!(row.names(no4.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


dates_allvslysp<-read.table(file="../branchio_subsets/subsets_mcmctree/tmp.txt",sep=" ",header=T)
rownames(dates_allvslysp)<-dates_allvslysp$ID
dates_allvslysp<-dates_allvslysp[-2,-1]


plot5 <- ggplot(dates_allvslysp,aes(x=mean*100, y=mean_nolysp*100)) +
  geom_point() +
  ggtitle("All Species Dataset vs Dataset without Lynceus sp.") +
  labs(x = "Date estimates with all species", y = "Date estimates without Lynceus sp.") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=dates_allvslysp$X95._lower*100, xmax=dates_allvslysp$X95._upper*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=dates_allvslysp$X95._lower_nolysp*100, ymax=dates_allvslysp$X95._upper_nolysp*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))

# ALL TREE
all.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 3.634059, Iele: 3.634059) [&95%={0.737279, 5.08848}]: 1.324361, (((Blyn: 0.266181, Blin: 0.266181) [&95%={0.0658616, 0.597975}]: 1.007608, (Afr1: 1.036729, (Bher: 0.707185, (Stsp: 0.609131, Tpla: 0.609131) [&95%={0.330011, 0.880737}]: 0.098054) [&95%={0.401843, 0.965316}]: 0.329544) [&95%={0.777679, 1.17695}]: 0.237060) [&95%={1.25782, 1.30339}]: 2.792129, (((Tlon: 0.855106, (Tita: 0.294715, (Tusa: 0.060144, Tjap: 0.060144) [&95%={0.020136, 0.137451}]: 0.234571) [&95%={0.134932, 0.50772}]: 0.560391) [&95%={0.62279, 1.03039}]: 0.380029, ((Lcry: 0.315365, Lpac: 0.315365) [&95%={0.148522, 0.536336}]: 0.400666, (Lubb: 0.370249, (Lapu: 0.310294, (Lcou: 0.137258, Lart: 0.137258) [&95%={0.0653136, 0.255869}]: 0.173035) [&95%={0.175744, 0.490623}]: 0.059955) [&95%={0.218267, 0.559086}]: 0.345782) [&95%={0.516854, 0.904909}]: 0.519104) [&95%={1.21872, 1.26526}]: 1.987149, (Lysp: 2.740275, (((Orub: 0.570989, (Ozsp: 0.481092, Cpil: 0.481092) [&95%={0.196043, 0.91723}]: 0.089897) [&95%={0.240827, 1.03756}]: 0.812647, ((Eosp: 0.983066, (Ldah: 0.508189, Etic: 0.508189) [&95%={0.209599, 0.900334}]: 0.474877) [&95%={0.597835, 1.38715}]: 0.170545, ((Mesp: 0.415036, Etex: 0.415036) [&95%={0.165884, 0.774029}]: 0.412751, (Puru: 0.393182, (Lpar: 0.205961, Lbir: 0.205961) [&95%={0.0720999, 0.442125}]: 0.187221) [&95%={0.155502, 0.738493}]: 0.434606) [&95%={0.451611, 1.2405}]: 0.325824) [&95%={0.733726, 1.56866}]: 0.230024) [&95%={0.920754, 1.8293}]: 0.972400, ((Chis: 0.736458, C146: 0.736458) [&95%={0.186309, 1.28747}]: 1.220668, (Scry: 1.745134, ((Pped: 1.241071, (Pleu: 0.724312, Enor: 0.724312) [&95%={0.296855, 1.17707}]: 0.516759) [&95%={0.829608, 1.51031}]: 0.346428, ((Bosp: 1.177837, (Elam: 0.257397, Aema: 0.257397) [&95%={0.0847145, 0.564084}]: 0.920440) [&95%={0.874826, 1.40847}]: 0.254409, (Mosp: 1.051237, (Masp: 0.979396, ((Cqua: 0.725484, (Svet: 0.313429, Smuc: 0.313429) [&95%={0.180215, 0.500434}]: 0.412055) [&95%={0.514604, 0.951929}]: 0.090934, (Dmag: 0.569249, (Dgal: 0.350995, (Dpul: 0.059634, Dpli: 0.059634) [&95%={0.0214312, 0.138137}]: 0.291361) [&95%={0.176489, 0.575961}]: 0.218254) [&95%={0.349793, 0.805346}]: 0.247170) [&95%={0.595635, 1.04098}]: 0.162978) [&95%={0.739202, 1.19704}]: 0.071841) [&95%={0.807219, 1.25929}]: 0.381009) [&95%={1.22321, 1.5701}]: 0.155253) [&95%={1.42735, 1.67234}]: 0.157635) [&95%={1.73152, 1.77082}]: 0.211992) [&95%={1.83139, 2.22748}]: 0.398909) [&95%={2.02756, 2.89972}]: 0.384239) [&95%={2.23434, 3.37384}]: 0.482009) [&95%={2.52256, 3.76637}]: 0.843633) [&95%={4.0506, 4.09484}]: 0.892502) [&95%={4.73972, 5.28311}];","END;"))
all.tree <- readMCMCtree(all.tree, from.file = FALSE)
# NO LYSP TREE
nolysp.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.567391, Iele: 4.567391) [&95%={3.64554, 5.13013}]: 0.348361, (((Blyn: 0.184843, Blin: 0.184843) [&95%={0.0858299, 0.35493}]: 1.090215, (Afr1: 1.051796, (Bher: 0.741638, (Stsp: 0.598639, Tpla: 0.598639) [&95%={0.383803, 0.812534}]: 0.142999) [&95%={0.525328, 0.944971}]: 0.310158) [&95%={0.872574, 1.18086}]: 0.223263) [&95%={1.25792, 1.3051}]: 2.791021, (((Tlon: 0.462610, (Tita: 0.041969, (Tusa: 0.004952, Tjap: 0.004952) [&95%={0.0022598, 0.0097788}]: 0.037018) [&95%={0.0205872, 0.0784247}]: 0.420641) [&95%={0.220289, 0.809126}]: 0.769301, ((Lcry: 0.072841, Lpac: 0.072841) [&95%={0.0337677, 0.13588}]: 0.162456, (Lubb: 0.085198, (Lapu: 0.071107, (Lcou: 0.035190, Lart: 0.035190) [&95%={0.0180125, 0.0614742}]: 0.035917) [&95%={0.0431286, 0.112514}]: 0.014091) [&95%={0.0539564, 0.13048}]: 0.150099) [&95%={0.140888, 0.38818}]: 0.996614) [&95%={1.21846, 1.25891}]: 2.160812, (((Orub: 0.372032, (Ozsp: 0.300639, Cpil: 0.300639) [&95%={0.154036, 0.529116}]: 0.071392) [&95%={0.211617, 0.617533}]: 1.014036, ((Eosp: 0.946259, (Ldah: 0.492319, Etic: 0.492319) [&95%={0.256267, 0.792326}]: 0.453940) [&95%={0.662401, 1.25751}]: 0.200535, ((Mesp: 0.395340, Etex: 0.395340) [&95%={0.204383, 0.654474}]: 0.422721, (Puru: 0.373784, (Lpar: 0.195066, Lbir: 0.195066) [&95%={0.0979167, 0.342675}]: 0.178718) [&95%={0.224651, 0.583563}]: 0.444278) [&95%={0.578456, 1.11411}]: 0.328732) [&95%={0.879065, 1.48532}]: 0.239273) [&95%={1.07467, 1.75469}]: 1.198566, ((Chis: 0.533181, C146: 0.533181) [&95%={0.249461, 0.988192}]: 1.522667, (Scry: 1.746470, ((Pped: 1.154910, (Pleu: 0.656304, Enor: 0.656304) [&95%={0.366702, 0.983572}]: 0.498606) [&95%={0.850184, 1.41319}]: 0.435528, ((Bosp: 1.010615, (Elam: 0.144883, Aema: 0.144883) [&95%={0.0686215, 0.273411}]: 0.865732) [&95%={0.670336, 1.26609}]: 0.408303, (Mosp: 1.088681, (Masp: 0.959763, ((Cqua: 0.610416, (Svet: 0.222972, Smuc: 0.222972) [&95%={0.116499, 0.36949}]: 0.387444) [&95%={0.433069, 0.801926}]: 0.152172, (Dmag: 0.490721, (Dgal: 0.272830, (Dpul: 0.039483, Dpli: 0.039483) [&95%={0.0183203, 0.0755962}]: 0.233347) [&95%={0.150985, 0.434955}]: 0.217892) [&95%={0.329441, 0.68024}]: 0.271867) [&95%={0.588221, 0.949893}]: 0.197175) [&95%={0.768085, 1.14641}]: 0.128918) [&95%={0.888471, 1.26362}]: 0.330237) [&95%={1.22793, 1.55935}]: 0.171520) [&95%={1.44521, 1.68289}]: 0.156032) [&95%={1.73168, 1.7732}]: 0.309378) [&95%={1.85483, 2.40355}]: 0.528785) [&95%={2.17856, 3.10576}]: 0.808090) [&95%={2.83985, 3.81931}]: 0.673356) [&95%={4.05065, 4.09525}]: 0.849673) [&95%={4.73423, 5.26081}];","END;"))
nolysp.tree <- readMCMCtree(nolysp.tree, from.file = FALSE)
# CONC vs DISC PLOT
# CONCORDANCE SUBSET
conc.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.657473, Iele: 4.657473) [&95%={3.94617, 5.13342}]: 0.237328, (((Blyn: 0.172999, Blin: 0.172999) [&95%={0.0832141, 0.32186}]: 1.101822, (Afr1: 1.003902, (Bher: 0.696365, (Stsp: 0.574730, Tpla: 0.574730) [&95%={0.362662, 0.794209}]: 0.121635) [&95%={0.485634, 0.905362}]: 0.307537) [&95%={0.810452, 1.15217}]: 0.270918) [&95%={1.25783, 1.3049}]: 2.791594, (((Tlon: 0.436908, (Tita: 0.043189, (Tusa: 0.002764, Tjap: 0.002764) [&95%={0.0011045, 0.0057511}]: 0.040425) [&95%={0.0213052, 0.080165}]: 0.393719) [&95%={0.222156, 0.757916}]: 0.794889, ((Lcry: 0.063525, Lpac: 0.063525) [&95%={0.0332871, 0.108178}]: 0.083939, (Lubb: 0.083636, (Lapu: 0.068637, (Lcou: 0.038697, Lart: 0.038697) [&95%={0.0204121, 0.0660195}]: 0.029940) [&95%={0.0425198, 0.105652}]: 0.014999) [&95%={0.0539449, 0.123781}]: 0.063828) [&95%={0.0984385, 0.222605}]: 1.084332) [&95%={1.21849, 1.25838}]: 2.184840, (Lysp: 2.989636, (((Orub: 0.306319, (Ozsp: 0.216625, Cpil: 0.216625) [&95%={0.113564, 0.376694}]: 0.089694) [&95%={0.181347, 0.496661}]: 1.028830, ((Eosp: 0.873837, (Ldah: 0.417190, Etic: 0.417190) [&95%={0.223382, 0.672081}]: 0.456646) [&95%={0.622116, 1.16084}]: 0.191597, ((Mesp: 0.314854, Etex: 0.314854) [&95%={0.163871, 0.527439}]: 0.416666, (Puru: 0.289850, (Lpar: 0.139600, Lbir: 0.139600) [&95%={0.0699387, 0.248232}]: 0.150250) [&95%={0.172203, 0.456414}]: 0.441670) [&95%={0.512911, 1.00495}]: 0.333913) [&95%={0.818579, 1.36041}]: 0.269716) [&95%={1.03797, 1.72175}]: 1.174917, ((Chis: 0.471796, C146: 0.471796) [&95%={0.228357, 0.871197}]: 1.579175, (Scry: 1.746430, ((Pped: 1.143439, (Pleu: 0.618958, Enor: 0.618958) [&95%={0.349409, 0.928247}]: 0.524480) [&95%={0.849642, 1.38322}]: 0.420535, ((Bosp: 1.032847, (Elam: 0.174691, Aema: 0.174691) [&95%={0.0833779, 0.32239}]: 0.858156) [&95%={0.728025, 1.26575}]: 0.347078, (Mosp: 1.065743, (Masp: 0.930338, ((Cqua: 0.593207, (Svet: 0.215158, Smuc: 0.215158) [&95%={0.116673, 0.348629}]: 0.378049) [&95%={0.430428, 0.769722}]: 0.122899, (Dmag: 0.477778, (Dgal: 0.247792, (Dpul: 0.035352, Dpli: 0.035352) [&95%={0.0167884, 0.0658592}]: 0.212440) [&95%={0.140355, 0.392941}]: 0.229986) [&95%={0.324277, 0.657726}]: 0.238329) [&95%={0.556912, 0.891048}]: 0.214232) [&95%={0.74895, 1.11535}]: 0.135405) [&95%={0.874277, 1.24861}]: 0.314182) [&95%={1.20429, 1.5308}]: 0.184049) [&95%={1.41125, 1.66631}]: 0.182456) [&95%={1.73167, 1.7729}]: 0.304540) [&95%={1.86345, 2.3508}]: 0.459096) [&95%={2.1755, 2.92472}]: 0.479570) [&95%={2.55061, 3.41865}]: 0.427000) [&95%={2.95647, 3.78177}]: 0.649779) [&95%={4.05067, 4.09584}]: 0.828386) [&95%={4.73238, 5.24305}];","END;"))
conc.tree <- readMCMCtree(conc.tree, from.file = FALSE)
# DISCORDANCE SUBSET
disc.tree <- as.character(c("#NEXUS","begin trees","","((Scur: 4.530216, Iele: 4.530216) [&95%={3.50759, 5.11733}]: 0.388044, (((Blyn: 0.188104, Blin: 0.188104) [&95%={0.0870292, 0.354397}]: 1.086949, (Afr1: 1.062181, (Bher: 0.750673, (Stsp: 0.606218, Tpla: 0.606218) [&95%={0.391139, 0.820205}]: 0.144455) [&95%={0.536051, 0.954248}]: 0.311508) [&95%={0.88346, 1.18513}]: 0.212872) [&95%={1.25781, 1.30552}]: 2.790946, (((Tlon: 0.465635, (Tita: 0.042319, (Tusa: 0.005369, Tjap: 0.005369) [&95%={0.0023955, 0.01052}]: 0.036950) [&95%={0.0204503, 0.0801272}]: 0.423316) [&95%={0.225127, 0.81719}]: 0.766473, ((Lcry: 0.074542, Lpac: 0.074542) [&95%={0.0341164, 0.141615}]: 0.176003, (Lubb: 0.086739, (Lapu: 0.072465, (Lcou: 0.035149, Lart: 0.035149) [&95%={0.0176846, 0.062038}]: 0.037316) [&95%={0.043702, 0.114529}]: 0.014275) [&95%={0.054889, 0.133347}]: 0.163806) [&95%={0.150861, 0.418443}]: 0.981563) [&95%={1.21852, 1.25956}]: 2.207889, (Lysp: 2.953219, (((Orub: 0.382588, (Ozsp: 0.314786, Cpil: 0.314786) [&95%={0.161993, 0.544004}]: 0.067801) [&95%={0.220267, 0.623462}]: 1.006771, ((Eosp: 0.958481, (Ldah: 0.509653, Etic: 0.509653) [&95%={0.274869, 0.814632}]: 0.448828) [&95%={0.675199, 1.26746}]: 0.199781, ((Mesp: 0.410152, Etex: 0.410152) [&95%={0.2101, 0.679922}]: 0.419426, (Puru: 0.387658, (Lpar: 0.203974, Lbir: 0.203974) [&95%={0.101437, 0.360474}]: 0.183684) [&95%={0.228108, 0.609368}]: 0.441920) [&95%={0.578498, 1.13412}]: 0.328684) [&95%={0.888493, 1.49706}]: 0.231098) [&95%={1.07809, 1.77058}]: 1.146764, ((Chis: 0.538475, C146: 0.538475) [&95%={0.252326, 0.991484}]: 1.508140, (Scry: 1.746554, ((Pped: 1.163299, (Pleu: 0.666849, Enor: 0.666849) [&95%={0.373534, 0.989712}]: 0.496450) [&95%={0.853303, 1.42225}]: 0.433215, ((Bosp: 1.001168, (Elam: 0.139617, Aema: 0.139617) [&95%={0.0631935, 0.267611}]: 0.861551) [&95%={0.661894, 1.26338}]: 0.425886, (Mosp: 1.099781, (Masp: 0.972166, ((Cqua: 0.621304, (Svet: 0.227028, Smuc: 0.227028) [&95%={0.118746, 0.372019}]: 0.394276) [&95%={0.439994, 0.816198}]: 0.156004, (Dmag: 0.498695, (Dgal: 0.279543, (Dpul: 0.040579, Dpli: 0.040579) [&95%={0.0183754, 0.0786564}]: 0.238964) [&95%={0.156024, 0.44855}]: 0.219152) [&95%={0.33125, 0.692543}]: 0.278613) [&95%={0.599195, 0.964667}]: 0.194858) [&95%={0.778703, 1.15955}]: 0.127615) [&95%={0.89956, 1.26757}]: 0.327274) [&95%={1.23139, 1.56527}]: 0.169460) [&95%={1.45356, 1.68687}]: 0.150039) [&95%={1.73168, 1.77367}]: 0.300062) [&95%={1.85237, 2.3881}]: 0.489508) [&95%={2.16576, 3.00678}]: 0.417096) [&95%={2.49527, 3.43611}]: 0.486777) [&95%={2.9292, 3.83708}]: 0.626003) [&95%={4.05067, 4.09467}]: 0.852261) [&95%={4.73468, 5.26021}];","END;"))
disc.tree <- readMCMCtree(disc.tree, from.file = FALSE)

dates_concdisc <- as.data.frame(cbind(conc.tree$nodeAges[,1],disc.tree$nodeAges[,1],all.tree$nodeAges[,1]))
colnames(dates_concdisc) <- c("mean_conc","mean_disc","mean_all")
dates_concdisc<-dates_concdisc[-2,]
plot6 <- ggplot(dates_concdisc,aes(x=mean_conc*100, y=mean_disc*100)) +
  geom_point() +
  ggtitle("Concordance Dataset vs Discordance Dataset") +
  labs(x = "Date estimates with concordant genes", y = "Date estimates discordant genes") +
  geom_abline(slope = 1, intercept = 0, lty=2, color = "#008080") +
  geom_errorbar(aes(xmin=conc.tree$nodeAges[!(row.names(conc.tree$nodeAges) %in% c("50")),2]*100, xmax=conc.tree$nodeAges[!(row.names(conc.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  geom_errorbar(aes(ymin=disc.tree$nodeAges[!(row.names(disc.tree$nodeAges) %in% c("50")),2]*100, ymax=disc.tree$nodeAges[!(row.names(disc.tree$nodeAges) %in% c("50")),3]*100), width = 0.05, lty=2,col="salmon") +
  theme_bw() +
  theme(axis.title = element_text(size = 8), plot.title = element_text(size = 10),panel.grid.minor = element_line(color = "gray", linewidth = 0.2), panel.grid.major = element_line(color = "gray", linewidth = 0.2)) +
  scale_x_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50)) +
  scale_y_continuous(breaks = seq(0, 500, by = 100), minor_breaks = seq(0, 500, by = 50))


pdf("./Figure2.pdf", width = 8.27, height = 11.69)
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6, ncol = 2, labels = c("A", "", "", "","B","C"))
dev.off()



pdf("./Figure2_horizontal.pdf", width = 11.69, height = 8.27)
plot_grid(plot1,plot2,plot5,plot3,plot4,plot6,labels =c ("A","","B","","","C"),ncol=3)
dev.off()





# RIDGEPLOT OF CONFIDENCE INTERVALS IN EACH DATASET
# Needed datasets

all.tree.CI <- all.tree$nodeAges[,3] - all.tree$nodeAges[,2]
all.tree.CI <- cbind(all.tree.CI,rep("All calibration/genes/species",length(all.tree.CI)))
all.tree.CI <- all.tree.CI[-2,]

no1.tree.CI <- no1.tree$nodeAges[,3] - no1.tree$nodeAges[,2]
no1.tree.CI <- cbind(no1.tree.CI,rep("No Anostraca calibration",length(no1.tree.CI)))
no1.tree.CI <- no1.tree.CI[-2,]

no2.tree.CI <- no2.tree$nodeAges[,3] - no2.tree$nodeAges[,2]
no2.tree.CI <- cbind(no2.tree.CI,rep("No Notostraca calibration",length(no2.tree.CI)))
no2.tree.CI <- no2.tree.CI[-2,]

no3.tree.CI <- no3.tree$nodeAges[,3] - no3.tree$nodeAges[,2]
no3.tree.CI <- cbind(no3.tree.CI,rep("No Cladocera calibration",length(no3.tree.CI)))
no3.tree.CI <- no3.tree.CI[-2,]

no4.tree.CI <- no4.tree$nodeAges[,3] - no4.tree$nodeAges[,2]
no4.tree.CI <- cbind(no4.tree.CI,rep("No Branchiopoda calibration",length(no4.tree.CI)))
no4.tree.CI <- no4.tree.CI[-2,]

nolysp.tree.CI <- nolysp.tree$nodeAges[,3] - nolysp.tree$nodeAges[,2]
nolysp.tree.CI <- cbind(nolysp.tree.CI,rep("Wihout Lynceus sp.",length(nolysp.tree.CI)))
nolysp.tree.CI <- nolysp.tree.CI[-2,]

conc.tree.CI <- conc.tree$nodeAges[,3] - conc.tree$nodeAges[,2]
conc.tree.CI <- cbind(conc.tree.CI,rep("Concordant genes",length(conc.tree.CI)))
conc.tree.CI <- conc.tree.CI[-2,]

disc.tree.CI <- disc.tree$nodeAges[,3] - disc.tree$nodeAges[,2]
disc.tree.CI <- cbind(disc.tree.CI,rep("Discordant genes",length(disc.tree.CI)))
disc.tree.CI <- disc.tree.CI[-2,]

remove(CI_data)
CI <- as.vector(as.numeric(c(all.tree.CI[,1],no1.tree.CI[,1],no2.tree.CI[,1],no3.tree.CI[,1],no4.tree.CI[,1],nolysp.tree.CI[,1],conc.tree.CI[,1],disc.tree.CI[,1])))
Dataset <- as.vector(as.factor(c(all.tree.CI[,2],no1.tree.CI[,2],no2.tree.CI[,2],no3.tree.CI[,2],no4.tree.CI[,2],nolysp.tree.CI[,2],conc.tree.CI[,2],disc.tree.CI[,2])))
CI_data <- data.frame(CI = CI, Dataset = Dataset, CI100 = CI*100)
CI_data$CI100 <- CI_data$CI*100

pastel_palette <- c("#FFB6C1", "#FFD700", "#98FB98", "#ADD8E6", "#FFA07A", "#D8BFD8", "#87CEEB", "#F0E68C")

pdf("./Confidence_Intervals_Ridgeplot.pdf", width = 11.69, height = 8.27)
ggplot(CI_data, aes(x = CI100, y = Dataset, fill = Dataset)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.5)) +
  scale_fill_manual(values = pastel_palette) +
  labs(x = "Confidence Intervals of Date Estimates (My)",y="")
dev.off()

# To check whether there is a "Group" (in our case prior/dataset) effect on the distribution
# of the confidence intervals sizes
shapiro.test(CI_data$CI100)
kruskal.test(CI_data$CI100,CI_data$Dataset)